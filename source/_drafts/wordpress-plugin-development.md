---
title: WordPress å¤–æ›é–‹ç™¼æ—¥è¨˜
date: 2021-06-15 18:00:00
categories:
- å¤–æ›é–‹ç™¼
tags:
- composer
- phpunit
etoc: false
---

ä¸€å¹´å‰çš„é€™å€‹æ™‚å€™ï¼Œå¾æ—©åˆ°æ™šéƒ½åœ¨è·Ÿ WordPress çš„ä½ˆæ™¯ä¸»é¡Œæ‰“äº¤é“ï¼Œé™¤äº†å¿™æ¡ˆå­ä»¥å¤–ï¼Œç©ºæª”æ™‚å°±åœ¨ç ”ç©¶å“ªäº›å‰ç«¯æ¡†æ¶å¯ä»¥æ›´å¿«é€Ÿçš„èˆ‡ WordPress åšæ•´åˆï¼Œæƒ³ä¸åˆ°åäºŒå€‹æœˆéå»äº†ï¼Œç¾åœ¨æ¯å¤©éƒ½æ”¹æˆåœ¨å¯«å¤–æ›ï¼Œé›¢å‰ç«¯ç¨‹å¼é–‹ç™¼è¶Šä¾†è¶Šé ï¼Œåœä¸‹è…³æ­¥å›é ­ä¾†çœ‹ï¼Œæ„Ÿè¦ºæ˜¯è©²ä¾†å¥½å¥½æ•´ç†ä¸€ä¸‹é€™é™£å­çš„é–‹ç™¼å¿ƒå¾—äº†ã€‚

ç‚ºäº†æ–¹ä¾¿é–±è®€æˆ‘æ‹†æˆä»¥ä¸‹å¹¾å€‹ç« ç¯€ä¾†ç´€éŒ„ï¼š

[ä¸€ã€WordPress å¤–æ›æ¶æ§‹ - ç´€éŒ„æ›¾ç¶“ä½¿ç”¨éçš„æ¶æ§‹ä»¥åŠç›®å‰ä½œæ³•](https://oberonlai.blog/tw/wordpress-plugin-boilerplate)
[äºŒã€WordPress é–‹ç™¼å¯¦ç”¨ Composer å¥—ä»¶ - ä»‹ç´¹åœ¨å¯«å¤–æ›çš„æ™‚å€™å¯ä»¥åŠ é€Ÿé–‹ç™¼çš„å¥—ä»¶](https://oberonlai.blog/tw/wordpress-and-composer)
ä¸‰ã€è¼‰å…¥ä½ˆæ™¯ä¸»é¡Œç¯„æœ¬ - å¦‚ä½•åœ¨å¤–æ›è£¡é¢ä½¿ç”¨ç¯„æœ¬æª”ä¿®æ”¹å‰ç«¯ä»‹é¢ä¸¦æ•´åˆå‰ç«¯é–‹ç™¼æµç¨‹
å››ã€æ•´åˆ PHPUnit å–®å…ƒæ¸¬è©¦ - é¿å…æ”¹æ±ç‰†å£è¥¿ç‰†çš„å•é¡Œå†æ¬¡ç™¼ç”Ÿ
äº”ã€è‡ªå‹•åŒ–éƒ¨ç½² - è®“ WordPress æ­ä¸Š DevOps çš„åˆ—è»ŠğŸš„
å…­ã€WordPress å¤–æ›æ›´æ–° - è‡ªè¡Œç®¡ç†æœªä¸Šæ¶ wordpress.org çš„å¤–æ›ç‰ˆæœ¬ç¶­è­·

å¦‚æœæ˜¯å° WordPress å¤–æ›é–‹ç™¼å®Œå…¨æ²’æ¦‚å¿µçš„æœ‹å‹ï¼Œæˆ‘å»ºè­°å…ˆé–±è®€ [Plugin Developer Handbook](https://developer.wordpress.org/plugins/) æœƒæ¯”è¼ƒå®Œæ•´ï¼Œæˆ–æ˜¯è²·[é€™æœ¬æ›¸](https://oberonlai.blog/tw/building-web-apps-with-wordpress/)ä¾†çœ‹åœ¨å­¸ç¿’ä¸Šæœƒæ¯”è¼ƒæœ‰è„ˆçµ¡èˆ‡ç³»çµ±æ€§ã€‚è€Œé€™ç³»åˆ—æ–‡æ˜¯æˆ‘çš„å¯¦å‹™ç¶“é©—ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹å¯èƒ½é‚„æ˜¯æœƒæœ‰ä¸è¶³ä¹‹è™•ï¼Œå¸Œæœ›èƒ½é‡åˆ°å¤§å¤§å†å¹«æˆ‘æŒ‡é»è¿·æ´¥äº† ğŸ™

ç¬¬ä¸€ç¯‡æ–‡ç« ä¸»è¦ç´€éŒ„äº†æˆ‘åœ¨çµ„ç¹”å¤–æ›çµæ§‹çš„éç¨‹ï¼Œä¸¦é€éä¸æ–·çš„æ‰“æ‰é‡ç·´ä¾†æ‰¾åˆ°è‡ªå·±æœ€èˆ’æœçš„æ–¹å¼ï¼Œè®“æˆ‘å€‘é–‹å§‹å§ï½

<!--more-->

## WordPress å¤–æ›æ¶æ§‹

ä»¥ä½ˆæ™¯ä¸»é¡Œä¾†èªªï¼Œæœ‰å¾ˆå¤šå…¬å¸æ¨å‡ºåˆå§‹ä½ˆæ™¯ä¸»é¡Œ ( Starter Theme ) å¯ä»¥å…¥é–€ï¼Œç›¸è¼ƒä¹‹ä¸‹å¤–æ›å°±å°‘å¾ˆå¤šï¼ŒåŸå› å¯èƒ½æ˜¯å¤–æ›çš„çµ„ç¹”æ–¹å¼å¤ªè‡ªç”±äº†ï¼ŒåŸºæœ¬ä¸Šæˆ‘å¯ä»¥æŠŠæ‰€æœ‰çš„ç¨‹å¼ç¢¼å…¨éƒ½å¡é€²åˆ°å¸¶æœ‰æ¨™é ­çš„ PHP æª”æ¡ˆå³å¯ï¼Œä¸éœ€è¦æ‹†åˆ†ä»»ä½•æª”æ¡ˆèˆ‡è³‡æ–™å¤¾ï¼Œä½†å¦‚æœæ˜¯åšåŠŸèƒ½è¤‡é›œæˆ–æ˜¯å¤§å‹å¤–æ›çš„æ“´å……ï¼Œé€™æ¨£åšæœƒè¢«æœªä¾†çš„è‡ªå·±ç½µåˆ°è‡­é ­XD

å‰›é–‹å§‹å¯¦ä½œçš„æ™‚å€™æˆ‘æ˜¯æ¡ç”¨ã€Œ [WordPress Plugin Boilerplate Generator](https://wppb.me)ã€ï¼Œä¸ç®¡è¦åšçš„åŠŸèƒ½æ˜¯å¤§é‚„æ˜¯å°ï¼Œæˆ‘è¦ºå¾—éµå¾ªé€™å¥—æ¶æ§‹å¯ä»¥è®“æª”æ¡ˆå¾ˆæœ‰é‚è¼¯èˆ‡ç³»çµ±ï¼Œå®ƒçš„ç‰¹è‰²æ˜¯åœ¨æ–¼æŠŠå‰å¾Œå°çš„è³‡æ–™å¤¾åˆ‡åˆ†é–‹ä¾†ï¼Œç„¶å¾Œé€éä¸€å±¤åˆä¸€å±¤çš„é¡åˆ¥ä¾†åšè¼‰å…¥ã€‚

```
â”€â”€ LICENSE.txt
â”œâ”€â”€ README.txt
â”œâ”€â”€ admin
â”‚Â Â  â”œâ”€â”€ class-my-plugin-admin.php
â”‚Â Â  â”œâ”€â”€ css
â”‚Â Â  â”‚Â Â  â””â”€â”€ my-plugin-admin.css
â”‚Â Â  â”œâ”€â”€ index.php
â”‚Â Â  â”œâ”€â”€ js
â”‚Â Â  â”‚Â Â  â””â”€â”€ my-plugin-admin.js
â”‚Â Â  â””â”€â”€ partials
â”‚Â Â      â””â”€â”€ my-plugin-admin-display.php
â”œâ”€â”€ includes
â”‚Â Â  â”œâ”€â”€ class-my-plugin-activator.php
â”‚Â Â  â”œâ”€â”€ class-my-plugin-deactivator.php
â”‚Â Â  â”œâ”€â”€ class-my-plugin-i18n.php
â”‚Â Â  â”œâ”€â”€ class-my-plugin-loader.php
â”‚Â Â  â”œâ”€â”€ class-my-plugin.php
â”‚Â Â  â””â”€â”€ index.php
â”œâ”€â”€ index.php
â”œâ”€â”€ languages
â”‚Â Â  â””â”€â”€ my-plugin.pot
â”œâ”€â”€ my-plugin.php
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ class-my-plugin-public.php
â”‚Â Â  â”œâ”€â”€ css
â”‚Â Â  â”‚Â Â  â””â”€â”€ my-plugin-public.css
â”‚Â Â  â”œâ”€â”€ index.php
â”‚Â Â  â”œâ”€â”€ js
â”‚Â Â  â”‚Â Â  â””â”€â”€ my-plugin-public.js
â”‚Â Â  â””â”€â”€ partials
â”‚Â Â      â””â”€â”€ my-plugin-public-display.php
â””â”€â”€ uninstall.php
```

ä½†ç¶“éå¹¾å€‹å°ˆæ¡ˆå¾Œç™¼ç¾ä¸å¤ªé †æ‰‹ï¼Œå•é¡Œåœ¨æ–¼å®ƒæŠŠå‹¾é» ( Hook ) è·Ÿè¦è·‘åœ¨å‹¾é»ä¸Šçš„å‡½å¼åˆ‡é–‹ä¾†ï¼Œå¸¸å¸¸åœ¨æ‰¾é€™æ”¯å‡½å¼æ˜¯è·‘åœ¨å“ªå€‹å‹¾é»ä¸Šæ™‚æœƒèŠ±ä¸Šä¸€äº›æ™‚é–“ï¼Œæ›´ä¸ç”¨èªªåœ¨å¯«å‹¾é»çš„æ™‚å€™é‚„éœ€è¦åˆ‡æ›æª”æ¡ˆå¾ˆå®¹æ˜“æ··äº‚ã€‚

å…¶æ¬¡æ˜¯å¾ˆå¤šåŠŸèƒ½å¾ˆé›£ç•Œå®šå®ƒåˆ°åº•æ˜¯å±¬æ–¼å‰å°é‚„å¾Œå°ï¼Œåƒæ˜¯åœ¨åš REST API æˆ‘æœ‰æ™‚å€™æœƒæ”¾åœ¨ publicï¼Œæœ‰æ™‚å€™å¿˜è¨˜åˆæœƒæ”¾åœ¨ adminï¼Œè¦æ‰¾çš„æ™‚å€™è‡ªå·±éƒ½æœƒææ··ã€‚

ç„¶å¾Œæœ€éº»ç…©çš„åœ°æ–¹æ˜¯æª”æ¡ˆçš„è¼‰å…¥ï¼ŒWPPB æ˜¯ä½¿ç”¨ require çš„æ–¹å¼ä¾†å¼•å…¥ï¼Œæ‰€ä»¥å¦‚æœæ–°å¢æª”æ¡ˆæˆ–æ˜¯ä¿®æ”¹æª”åçš„æ™‚å€™éƒ½æœƒéœ€è¦æ‰‹å‹•ä¿®æ”¹ï¼Œæœ€å¸¸ç™¼ç”Ÿçš„æƒ…æ³å°±æ˜¯é¡åˆ¥å¯«å®Œå¾Œä¸€ç›´è·‘ä¸å‹•ï¼Œè¿½æŸ¥å¾Œæ‰ç™¼ç¾æ ¹æœ¬å¿˜è¨˜å¼•å…¥äº† ğŸ˜…

æ‰€ä»¥ä¸€ç›´åœ¨æ‰¾å°‹è‘—æœ‰æ²’æœ‰æ›´å¥½çš„æ¶æ§‹å¯ä»¥ä¾†é–‹ç™¼å¤–æ›ï¼Œæ‰¾äº†è€åŠå¤©éƒ½æ²’æœ‰é©åˆè‡ªå·±çš„ï¼Œç´¢æ€§å°±ä¾†ç™¼å±•ä¸€å¥—è‡ªå·±çš„é‚è¼¯å§ï½

å‰›å¥½ç•¶æ™‚åœ¨çœ‹ã€Œ[ç¾ä»£ PHP](https://www.books.com.tw/products/0010688181) ã€é€™æœ¬æ›¸ï¼Œå°æ–¼ Composer å¾ˆæœ‰èˆˆè¶£ï¼Œå°±é–‹å§‹è©¦è‘—æŠŠ Composer æ•´åˆé€² WordPress çš„é–‹ç™¼æµç¨‹ä¹‹ä¸­ã€‚

Composer å¯ä»¥ç°¡å–®çš„ç†è§£ç‚ºæ˜¯ä¸€å¥—å¯ä»¥å®‰è£ PHP å¤–æ›çš„å·¥å…·ï¼Œå¯ä»¥æŠŠåˆ¥äººå¯«å¥½çš„ PHP é¡åˆ¥é€é Composer å®‰è£å¾Œé€²è¡Œä½¿ç”¨ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒé‚„å¯ä»¥å¹«åŠ©é–‹ç™¼è€…åšè‡ªå‹•è¼‰å…¥ã€å¥—ä»¶æ›´æ–°ç®¡ç†ï¼Œç”šè‡³é‚„å¯ä»¥å®‰è£ WP çš„å¤–æ›ï¼Œé€éå®ƒä¾†ç®¡ç† WP ç¶²ç«™çš„å¤–æ›ï¼Œä½ ä¹Ÿå¯ä»¥ä¸Šå‚³è‡ªå·±å¯«çš„å¥—ä»¶ï¼ŒæŠŠä¸€äº›å¸¸ç”¨çš„é¡åˆ¥æ‰“åŒ…å¥½å¾Œä¸Šå‚³ï¼Œä¸‹æ¬¡è¦ç”¨æ™‚ç›´æ¥é€é Composer é€²è¡Œå®‰è£ã€‚

æ›´å¤š Composer çš„å¯¦ä½œç´°ç¯€æœƒéš¨è‘—ä¸‹æ–‡é€ä¸€å¸¶åˆ°ï¼Œå›åˆ° WordPress å¤–æ›é–‹ç™¼æ¶æ§‹çš„éœ€æ±‚ï¼Œæˆ‘æƒ³è¦çš„æ˜¯å¯ä»¥ä¾ç…§å°ˆæ¡ˆè¦æ¨¡è‡ªè¡Œå¢åŠ è³‡æ–™å¤¾çµæ§‹ä»¥åŠæª”æ¡ˆå‘½åï¼Œå°¤å…¶æ˜¯å¤–æ›é–‹ç™¼çš„åˆæœŸåŠŸèƒ½é‚„å¾ˆé™½æ˜¥ï¼Œå¯èƒ½å¹¾å€‹æª”æ¡ˆå°±æå®šï¼Œç­‰åˆ°å¤–æ›ç™¼å±•çš„è¶Šä¾†è¶Šå¤§ï¼Œæˆ‘å¯ä»¥éš¨æ™‚èª¿æ•´æª”æ¡ˆçµæ§‹ä»¥ç¬¦åˆå•†æ¥­é‚è¼¯çš„è®Šå‹•ã€‚

åƒè€ƒäº†å¾ˆå¤šå…è²»èˆ‡ä»˜è²»å¤–æ›çš„çµæ§‹å¾Œï¼Œç›®å‰å·²ç™¼å±•å‡ºä¸€å¥—è‡ªå·±çš„ SOPï¼Œå¤§æ¦‚çš„é †åºå¦‚ä¸‹

### 1.å»ºç«‹åŸºæœ¬æ¶æ§‹

å»ºç«‹å¤–æ›çš„ç¬¬ä¸€æ­¥å°±æ˜¯åœ¨ wp-content/plugins åº•ä¸‹å»ºç«‹è³‡æ–™å¤¾ï¼Œç„¶å¾Œæ–°å¢ä¸»æª”æ¡ˆèˆ‡ src (source) è³‡æ–™å¤¾æ”¾ä¸»ç¨‹å¼ï¼Œé€™æ¨£å°±å®Œæˆæœ€åŸºæœ¬çš„çµæ§‹äº†ã€‚

```
my-plugin
â”œâ”€â”€ my-plugin.php
â””â”€â”€ src
```

å¦‚æœå°ˆæ¡ˆæœ‰å‰ç«¯çš„éƒ¨åˆ†éœ€è¦è™•ç†ï¼Œæˆ‘æœƒé–‹ assets è³‡æ–™å¤¾ï¼Œè£¡é¢æœƒæ”¾åœ–æª”ã€CSS èˆ‡ JavaScript ç­‰éœæ…‹æª”æ¡ˆï¼š

```
my-plugin
â””â”€â”€ assets
    â”œâ”€â”€ css
    â”‚   â”œâ”€â”€ admin.css
    â”‚   â””â”€â”€ public.css
    â”œâ”€â”€ img
    â”‚   â””â”€â”€ img1.jpg
    â””â”€â”€ js
        â”œâ”€â”€ admin.js
        â”œâ”€â”€ ajax.js
        â””â”€â”€ public.js
```

å‰å¾Œå°çš„éœæ…‹æª”å°±ç”¨æª”åä¾†å€åˆ†ï¼Œå‰å°å°±æ˜¯ public å¾Œå°æ˜¯ adminï¼Œå¦‚æœæœ‰éœ€è¦åš Ajax çš„ JS æª”ä¹Ÿæ˜¯æœƒæ”¾åœ¨é€™é‚Šã€‚å¦‚æœè¦é€²ä¸€æ­¥çš„æ•´åˆ Node.js ä¾†åšå‰ç«¯çš„æª”æ¡ˆç·¨è­¯ï¼Œassets ä¸‹é¢æœƒå†å€åˆ† src è·Ÿ distï¼Œç„¶å¾Œæ‰æ”¾ imgã€css èˆ‡ js è³‡æ–™å¤¾ï¼Œä¹‹å‰æœ‰å¯¦ä½œéæ•´åˆæœ€è¿‘éå¸¸ç´…çš„ CSS æ¡†æ¶ Tailwindcssï¼Œé€™éƒ¨åˆ†æœƒåœ¨ä¹‹å¾Œçš„æ–‡ç« æåˆ°ã€‚

å†ä¾†å¦‚æœé€™å€‹å¤–æ›æœ‰éœ€è¦è™•ç†ç¯„æœ¬çš„è©±ï¼Œæˆ‘æœƒå†å¦å¤–é–‹ä¸€å€‹ views è³‡æ–™å¤¾ï¼Œé€™è³‡æ–™å¤¾å°±åƒæ˜¯ä½ˆæ™¯ä¸»é¡Œä¸€æ¨£ï¼Œå°ˆé–€æ”¾ç¯„æœ¬æª”ï¼š

```
my-plugin
â””â”€â”€ views
    â”œâ”€â”€ loops
    â”‚   â””â”€â”€ post.php
    â”œâ”€â”€ page-about.php
    â”œâ”€â”€ page-contact.php
    â”œâ”€â”€ partials
    â”‚   â””â”€â”€ pagination.php
	â”œâ”€â”€ woocommerce
    â”‚   â””â”€â”€ checkout
    â”œâ”€â”€ template-2col.php
    â””â”€â”€ template-blank.php
```

views é™¤äº†æ”¾å°æ‡‰ slug çš„ç¯„æœ¬æª”ä¹‹å¤–ï¼Œä¹Ÿæ”¾äº†é é¢ç¯„æœ¬ï¼Œloops è³‡æ–™å¤¾æ”¾çš„æ˜¯éœ€è¦è·‘åœ¨ WP_Query è£¡é¢çš„åˆ—è¡¨é¡å…§å®¹ï¼Œè€Œ partials æ”¾çš„æ˜¯æ‰€æœ‰é é¢æœƒå…±ç”¨åˆ°çš„å…ƒä»¶ï¼Œåƒæ˜¯åˆ†é å°è¦½ paginationã€‚å¦‚æœæ˜¯åš WooCommerce çš„ Extension æˆ‘æœƒå†å¤šé–‹ä¸€å€‹è³‡æ–™æ”¾ WC çš„ç¯„æœ¬æª”ï¼Œé€™æ¨£å°±èƒ½å¾å¤–æ›ä¾†ä¿®æ”¹ WC ç›¸é—œé é¢çš„å…§å®¹ã€‚

å†ä¾†æ˜¯ src è£¡é¢çš„çµæ§‹ï¼Œå˜—è©¦äº†å¾ˆå¤šå‘½åæ–¹æ³•ï¼Œæœ€å–œæ­¡çš„æ‡‰è©²æ˜¯ MVC æ¨¡å¼ï¼š

```
my-plugin
â””â”€â”€ src
    â”œâ”€â”€ controllers
    â”‚   â””â”€â”€ cpt.php
    â””â”€â”€ models
        â””â”€â”€ cpt.php
```

View çš„éƒ¨åˆ†æˆ‘æŠŠå®ƒç¨ç«‹åœ¨ src çš„è³‡æ–™å¤¾å¤–é¢ï¼ŒåŸå› æ˜¯ src çš„è³‡æ–™å¤¾æœƒé€é PSR-4 çš„ Autoload è¼‰å…¥ï¼Œä½† WP çš„ç¯„æœ¬æª”ä¸¦ä¸æ”¯æ´é€™æ¨£çš„æ©Ÿåˆ¶ï¼Œæ‰€ä»¥æŠŠ views ç¨ç«‹åœ¨ src ä»¥å¤–é¿å…è¢«è‡ªå‹•è¼‰å…¥ã€‚

Models è³‡æ–™å¤¾æˆ‘æ”¾çš„æ˜¯éœ€è¦æ–°å¢æˆ–ä¿®æ”¹è³‡æ–™åº«çµæ§‹çš„é¡åˆ¥ï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯æ–°å¢ Custom Post Typeï¼Œæˆ–æ˜¯éœ€è¦ä¿®æ”¹é è¨­çš„æ–‡ç« æˆ–é é¢ post typeã€æ–°å¢ optionsã€widgetï¼Œæˆ‘éƒ½æœƒæ”¾åœ¨ Models è³‡æ–™å¤¾ä¸‹é¢ã€‚

Controllers å‰‡æ˜¯è² è²¬è™•ç† Models è£¡é¢å„ç¨® post type æˆ–æ˜¯ option çš„ CRUDï¼Œä»¥åŠå„ç¨® WP å…§å»ºæ©Ÿåˆ¶çš„è™•ç†ï¼Œåƒæ˜¯ REST APIã€WP Cronã€Shortcode ç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šé€™å€‹è³‡æ–™å¤¾æœƒæ”¾æ‰€æœ‰çš„é‚è¼¯è™•ç†é¡åˆ¥ï¼Œéœ€è¦å‘¼å«é¡åˆ¥çš„ç¨‹å¼ä¹Ÿæ˜¯æ”¾åœ¨é€™é‚Šã€‚

å¦‚æœæœ‰å¤šå€‹ CPT éœ€è¦è™•ç†å¤šç¨®æ“ä½œï¼Œæˆ‘æœƒå†æ–°å¢æ–°çš„è³‡æ–™å¤¾ä¾†åšå€åˆ†ï¼š

```
my-plugin
â””â”€â”€ src
    â”œâ”€â”€ controllers
    â”‚   â”œâ”€â”€ cpt.php
    â”‚   â”œâ”€â”€ cpt1
    â”‚   â”‚   â”œâ”€â”€ Api.php
    â”‚   â”‚   â”œâ”€â”€ Router.php
    â”‚   â”‚   â”œâ”€â”€ Post.php	
    â”‚   â”‚   â””â”€â”€ Shortcode.php
    â”‚   â””â”€â”€ cpt2
    â”‚       â”œâ”€â”€ Post.php
    â”‚       â””â”€â”€ Widget.php
    â””â”€â”€ models
        â””â”€â”€ cpt.php
```

é›–ç„¶å¾ MVC çš„è§’åº¦ä¸‹å»åˆ†é¡çœ‹ä¼¼å¾ˆæ¸…æ¥šï¼Œä½†å¯¦ä½œå¾Œå¸¸ç™¼ç¾è‡ªå·±æœƒæ··æ·† M è·Ÿ C çš„éƒ¨åˆ†ï¼Œæˆ‘æ›¾ç¶“åœ¨ä¸€å€‹å°ˆæ¡ˆä¸­æŠŠ Shortcode æ”¾åœ¨ Controllersï¼Œå¦ä¸€å€‹å°ˆæ¡ˆå»æ”¾åœ¨ Models è£¡é¢ï¼Œæˆ–æ˜¯è¦è¨»å†Š Rest API æˆ‘å°±å¸¸æœƒèˆ‰æ£‹ä¸å®šï¼Œé€™åˆ°åº•è©²æ”¾åœ¨å“ªè£¡å¥½ï¼Ÿ

æ–¼æ˜¯ç´¢æ€§å°±ä¸åˆ† Models è·Ÿ Controllers äº†ï¼Œç›´æ¥ä»¥ WordPress è³‡æ–™è¡¨çµæ§‹ä¾†å€åˆ†è³‡æ–™å¤¾ï¼š

```
my-plugin
â””â”€â”€ src
    â”œâ”€â”€ posts
    â”‚   â”œâ”€â”€ cpt1
    â”‚   â”‚   â”œâ”€â”€ Ajax.php
    â”‚   â”‚   â”œâ”€â”€ Field.php
    â”‚   â”‚   â””â”€â”€ Cpt1.php
    â”‚   â””â”€â”€ cpt2
    â”‚       â”œâ”€â”€ Api.php
    â”‚       â”œâ”€â”€ Cpt2.php
    â”‚       â””â”€â”€ Shortcode.php
    â”œâ”€â”€ terms
    â”‚   â”œâ”€â”€ taxonomy1
    â”‚   â”‚   â””â”€â”€ Field.php
    â”‚   â””â”€â”€ taxonomy2
    â”‚       â””â”€â”€ Api.php
    â”œâ”€â”€ options
    â”‚   â”œâ”€â”€ Field.php
    â”‚   â””â”€â”€ Menu.php
    â””â”€â”€ user
        â””â”€â”€ Field.php
```

æœ€å¸¸è™•ç†çš„æ˜¯ wp_postsï¼Œæ‰€ä»¥ posts è³‡æ–™å¤¾ä¸‹é¢æœƒæ”¾å„å€‹ CPT çš„è³‡æ–™å¤¾ï¼Œoptions æ˜¯åšè¨­å®šé é¢çš„ï¼Œå°æ‡‰çš„è³‡æ–™è¡¨æ˜¯ wp_optionsï¼Œuser æ˜¯ä½¿ç”¨è€…ç›¸é—œï¼Œå°æ‡‰çš„è³‡æ–™è¡¨æ˜¯ wp_usersï¼Œè‡³æ–¼ Taxonomy æˆ‘ä¹Ÿæœƒè·Ÿ Post æ‹†é–‹ç¨ç«‹æ”¾åœ¨ terms çš„è³‡æ–™å¤¾åº•ä¸‹ï¼Œåœ¨çµæ§‹ä¸Šæœƒæ›´æ¸…æ¥šäº›ã€‚

ç„¶å¾Œæ¯å€‹ cpt çš„è³‡æ–™å¤¾åº•ä¸‹ï¼Œæœƒæœ‰ä¸€æ”¯è·Ÿ CPT slug åŒåçš„æª”æ¡ˆï¼Œè£¡é¢æ”¾çš„æœƒæ˜¯è¨»å†Š CPT çš„åŠŸèƒ½ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æœƒç¤ºç¯„å¦‚ä½•ä½¿ç”¨ Composer å¥—ä»¶ä¾†è¨»å†Š CPTï¼Œå…¶ä»–çš„ Field.php ã€Ajax.phpã€Api.php å°±æ˜¯ç®¡ç†è©² CPT çš„ç›¸å°æ‡‰åŠŸèƒ½ã€‚

æ‰€ä»¥æ•´å€‹è³‡æ–™å¤¾çš„é‚è¼¯å°±æ˜¯ä»¥è³‡æ–™é¡å‹ > åŠŸèƒ½ä¾†å€åˆ†ï¼Œå°æˆ‘ä¾†èªªå¯ä»¥å†ä¹Ÿä¸ç”¨åˆ¤æ–·é€™åŠŸèƒ½åˆ°åº•æ˜¯å±¬æ–¼ Models é‚„æ˜¯ Controllersã€‚

æœ€å¾Œå‰‡æ˜¯å–®å…ƒæ¸¬è©¦çš„è³‡æ–™å¤¾ï¼š

```
my-plugin
â””â”€â”€ tests
    â””â”€â”€ cpt
        â””â”€â”€ cptTest.php
```

æ¸¬è©¦çš„éƒ¨åˆ†æ¯”è¼ƒè¤‡é›œï¼Œä¹‹å¾Œæœƒå†ä»¥ç¨ç«‹ç¯‡å¹…ä¾†é€²è¡Œèªªæ˜ã€‚

å¦å¤–å¦‚æœæ˜¯è¦åš i18n æœ¬åœ°åŒ–ï¼Œå°±éœ€è¦å†æ–°å¢ä¸€å€‹ languages è³‡æ–™å¤¾ï¼Œç¿»è­¯ç”¨çš„ .pot æª”å¯ä»¥é€é WP CLI ç”¢ç”Ÿã€‚

```
$ wp i18n make-pot . languages/my-plugin.pot
```

è³‡æ–™å¤¾çµæ§‹æœƒæ˜¯é€™æ¨£ï¼š
```
my-plugin
â””â”€â”€ languages
    â””â”€â”€ my-plugin.pot
```

æœ€å¾Œè¦–å°ˆæ¡ˆçš„éœ€æ±‚ï¼Œè³‡æ–™å¤¾çµæ§‹å¯ä»¥æ˜¯é€™æ¨£ï¼š

```
my-plugin
â”œâ”€â”€ my-plugin.php
â””â”€â”€ src
    â””â”€â”€ cpt1
        â””â”€â”€ Cpt1.php
```

ä¹Ÿå¯ä»¥é€æ¼¸ç™¼å±•æˆé€™æ¨£ï¼š

```
my-plugin
â”œâ”€â”€ assets
â”‚   â”œâ”€â”€ css
â”‚   â”‚   â”œâ”€â”€ admin.css
â”‚   â”‚   â””â”€â”€ public.css
â”‚   â”œâ”€â”€ img
â”‚   â”‚   â””â”€â”€ img1.jpg
â”‚   â””â”€â”€ js
â”‚       â”œâ”€â”€ admin.js
â”‚       â”œâ”€â”€ ajax.js
â”‚       â””â”€â”€ public.js
â”œâ”€â”€ my-plugin.php
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ posts
â”‚   â”‚   â”œâ”€â”€ cpt1
â”‚   â”‚   â”‚   â”œâ”€â”€ Ajax.php
â”‚   â”‚   â”‚   â”œâ”€â”€ Field.php
â”‚   â”‚   â”‚   â””â”€â”€ Cpt1.php
â”‚   â”‚   â””â”€â”€ cpt2
â”‚   â”‚       â”œâ”€â”€ Api.php
â”‚   â”‚       â”œâ”€â”€ Cpt2.php
â”‚   â”‚       â””â”€â”€ Shortcode.php
â”‚   â”œâ”€â”€ terms
â”‚   â”‚   â”œâ”€â”€ taxonomy1
â”‚   â”‚   â”‚   â””â”€â”€ Field.php
â”‚   â”‚   â””â”€â”€ taxonomy2
â”‚   â”‚       â””â”€â”€ Api.php
â”‚   â”œâ”€â”€ options
â”‚   â”‚   â”œâ”€â”€ Field.php
â”‚   â”‚   â””â”€â”€ Menu.php
â”‚   â””â”€â”€ user
â”‚       â””â”€â”€ Field.php
â”œâ”€â”€ tests
â”‚   â””â”€â”€ cpt
â”‚       â””â”€â”€ cptTest.php
â””â”€â”€ views
    â”œâ”€â”€ loops
    â”‚   â””â”€â”€ post.php
    â”œâ”€â”€ page-about.php
    â”œâ”€â”€ page-contact.php
    â”œâ”€â”€ partials
    â”‚   â””â”€â”€ pagination.php
    â”œâ”€â”€ template-2col.php
    â”œâ”€â”€ template-blank.php
    â””â”€â”€ woocommerce
```

åœ¨å¯¦å‹™ä¸­æˆ‘æœ€å¸¸è®Šå‹•çš„éƒ¨åˆ†æ˜¯ src è³‡æ–™å¤¾ï¼Œé™¤äº†éœ€æ±‚çš„æ–°å¢å¤–ï¼Œåšç¨‹å¼ç¢¼é‡æ§‹ä¹Ÿéƒ½æœƒå¸¸å¸¸ä¿®æ”¹é€™é‚Šï¼Œä»¥å¾€åªè¦è³‡æ–™å¤¾åç¨±æˆ–æ˜¯æª”æ¡ˆæœ‰æ–°å¢åˆªé™¤ï¼Œé€éæ‰‹å‹•å¼•å…¥çš„æ–¹å¼å°±å¿…é ˆè¦å…¨éƒ¨ä¿®æ”¹ï¼Œæœ‰æ²’æœ‰æ›´æ–¹ä¾¿ä¸”æ›´å½ˆæ€§çš„ä½œæ³•å‘¢ï¼Ÿæœ‰ï¼ç­”æ¡ˆå°±æ˜¯ Composerã€‚

### 2.è¨­å®š Composer ç’°å¢ƒ

å®‰è£ Composer çš„æ•™å­¸ç¶²è·¯éå¸¸å¤šï¼Œé€™é‚Šä¸»è¦ç¤ºç¯„çµ¦ WordPress å¤–æ›é–‹ç™¼è€…çš„ç’°å¢ƒè¨­å®šã€‚ç¬¬ä¸€æ­¥å…ˆé–‹å•Ÿçµ‚ç«¯æ©Ÿç„¶å¾ŒæŠŠç›®éŒ„åˆ‡åˆ°æ­£åœ¨é–‹ç™¼çš„å¤–æ›åº•ä¸‹ï¼š

```
$ cd wp-content\plugins\my-plugin
```

ç„¶å¾ŒåŸ·è¡Œ composer init

```
$ composer init
```

composer æœƒç”¨å°è©±å¼çš„ä»‹é¢ä¾†å”åŠ©æˆ‘å€‘é€²è¡Œè¨­å®šï¼Œä¾åºè¦å›ç­”å…­å€‹å•é¡Œï¼š

```
This command will guide you through creating your composer.json config.

Package name (<vendor>/<name>) [oberonlai/my-plugin]: 
Description []: 
Author [Oberon Lai <m615926@gmail.com>, n to skip]: 
Minimum Stability []: stable
Package Type (e.g. library, project, metapackage, composer-plugin) []: project
License []: propreitary
```

åŸºæœ¬ä¸Šå› ç‚ºé€™ä¸æ˜¯è¦ä¸Šå‚³åˆ° Composer å¥—ä»¶åº« Packagist çš„å¥—ä»¶ï¼Œæˆ‘ç¿’æ…£éƒ½ç›´æ¥æ¡ç”¨é è¨­å€¼ï¼Œå¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚å¯ä»¥å†å€‹åˆ¥èª¿æ•´ï¼Œç¬¬ä¸ƒé¡Œæ˜¯é—œéµï¼Œå®ƒæœƒå•ä½ æ˜¯å¦è¦å®‰è£ç›¸ä¾å¥—ä»¶ï¼š

```
Define your dependencies.

Would you like to define your dependencies (require) interactively [yes]? 
Search for a package: a7/autoload
Enter the version constraint to require (or leave blank to use the latest version): 
```

è¼¸å…¥å¥—ä»¶åç¨± a7/autoload æŒ‰ä¸‹ Enter å¾Œ Composer å°±æœƒé–‹å§‹è‡ªå‹•æœå°‹ Packagist ä¸Šé¢çš„æ‰€æœ‰ PHP å¥—ä»¶ä¸¦ä¸”æŒ‡å®šå®‰è£çš„ç‰ˆæœ¬ï¼Œå¦‚æœè¦å®‰è£æœ€æ–°ç‰ˆå°±ç›´æ¥ Enter ä¸‹ä¸€æ­¥å³å¯ï¼Œ[a7/autoload](https://github.com/a7/autoload) é€™å€‹å¥—ä»¶å¯ä»¥æŠŠæŒ‡å®šè³‡æ–™å¤¾è£¡é¢çš„æª”æ¡ˆå…¨éƒ¨è‡ªå‹•è¼‰å…¥ï¼Œå¦‚æœæ²’æœ‰å®ƒå°±éœ€è¦ä¸€å€‹ä¸€å€‹æ‰‹å‹•æŒ‡å®šè¦è‡ªå‹•è¼‰å…¥çš„è³‡æ–™å¤¾ã€‚

å®Œæˆå¾Œæ¥ä¸‹ä¾†åˆæœƒå†å•ä¸€æ¬¡æ˜¯å¦è¦æœå°‹å…¶ä»–å¥—ä»¶ï¼Œé€™é‚Šæˆ‘å€‘ä»€éº¼éƒ½ä¸è¼¸å…¥ç›´æ¥ä¸‹ Enter å³å¯ã€‚

æ¥ä¸‹ä¾†å®ƒæœƒè©¢å•æ˜¯å¦è¦å®‰è£åªæœ‰åœ¨é–‹ç™¼æ™‚æ‰éœ€è¦çš„å¥—ä»¶ï¼Œåƒæ˜¯åšå–®å…ƒæ¸¬è©¦ PHPUnit é€™ä¸€é¡åªæœƒåœ¨é–‹ç™¼ç’°å¢ƒä¸­éœ€è¦çš„å¥—ä»¶å°±å¯ä»¥åœ¨é€™é‚Šå®‰è£ï¼Œä½†ç›®å‰æˆ‘å€‘å…ˆè·³éï¼Œä¹‹å¾Œè¬›è§£å–®å…ƒæ¸¬è©¦çš„æ–‡ç« å†å¦è¡Œèªªæ˜ï¼š

```
Would you like to define your dev dependencies (require-dev) interactively [yes]? no
```

æ¥ä¸‹ä¾†å°±æœƒçœ‹åˆ°æ•´å€‹ Composer è¨­å®šæª”çš„è‰ç¨¿ï¼Œå®ƒæœƒè«‹ä½ ç¢ºèªæ˜¯å¦æ­£ç¢ºï¼Œè¼¸å…¥ Enter å³å¯ï¼Œé€™æ¨£å°±å®Œæˆ composer.json è¨­å®šæª”äº†ã€‚

```
{
    "name": "oberonlai/my-plugin",
    "type": "project",
    "require": {
        "a7/autoload": "^2.1"
    },
    "license": "propreitary",
    "authors": [
        {
            "name": "Oberon Lai",
            "email": "m615926@gmail.com"
        }
    ],
    "minimum-stability": "stable"
}

Do you confirm generation [yes]? yes
```

æœ€å¾Œå®ƒæœƒå•ä½ æ˜¯å¦è¦å®‰è£è¨­å®šæª”ä¸­çš„å¥—ä»¶ï¼ŒæŒ‰ä¸‹ Enter å³å¯

```
Would you like to install dependencies now [yes]? yes
```

æœ€å¾Œå°±æœƒå‡ºç¾å®‰è£å®Œæˆçš„è¨Šæ¯ï¼Œé€™å°±ä»£è¡¨æˆ‘å€‘å·²ç¶“æŠŠ Composer å·²ç¶“æ‰€éœ€å¥—ä»¶æº–å‚™å®Œæˆï¼š

```
No lock file found. Updating dependencies instead of installing from lock file. Use composer update over composer install if you do not have a lock file.
Loading composer repositories with package information
Updating dependencies
Lock file operations: 1 install, 0 updates, 0 removals
  - Locking a7/autoload (2.1)
Writing lock file
Installing dependencies from lock file (including require-dev)
Package operations: 1 install, 0 updates, 0 removals
  - Installing a7/autoload (2.1): Extracting archive
Generating autoload files
```

è§€å¯Ÿæˆ‘å€‘å¤–æ›çš„ç›®éŒ„ï¼Œæœƒç™¼ç¾å¤šäº† composer.jsonã€composer.lock ä»¥åŠ vendor è³‡æ–™å¤¾ï¼Œæœªä¾†æˆ‘å€‘ä»»ä½•å¾ Composer å®‰è£çš„å¥—ä»¶éƒ½æœƒæ”¾åœ¨ vendor é€™å€‹è³‡æ–™å¤¾åº•ä¸‹ï¼Œè‡³æ–¼è©²å¦‚ä½•å¼•å…¥é€™äº›å¥—ä»¶ä»¥åŠè®“ src è³‡æ–™å¤¾çš„æª”æ¡ˆå¯ä»¥è‡ªå‹•è¼‰å…¥å‘¢ï¼Ÿè®“æˆ‘å€‘é–‹å§‹å¯« code å§ï½

### 3.åŠ å…¥ Autoload æ©Ÿåˆ¶

æ‰“é–‹å¤–æ›çš„ä¸»æª”æ¡ˆï¼Œæˆ‘æŠŠä¸€äº›å¸¸ç”¨çš„å¯«æ³•å­˜æˆäº† VSCode çš„ Snippetï¼Œå…§å®¹å¦‚ä¸‹ï¼š

```php
<?php

 /**
 * @link              https://oberonlai.blog
 * @since             1.0.0
 * @package           ODS
 *
 * @wordpress-plugin
 * Plugin Name:       Oberon Plugin
 * Plugin URI:        https://oberonlai.blog
 * Description:       Oberon Lai Blog Demo Plugins
 * Version:           1.0.0
 * Author:            Oberon Lai
 * Author URI:        https://oberonlai.blog
 * License:           GPL-2.0+
 * License URI:       http://www.gnu.org/licenses/gpl-2.0.txt
 * Text Domain:       ods
 * Domain Path:       /languages
 */


if ( ! defined( 'ABSPATH' ) ) {
  exit;
}

define('ODS_VERSION', '1.0.0');
define('ODS_PLUGIN_URL', plugin_dir_url(__FILE__));
define('ODS_PLUGIN_DIR', plugin_dir_path(__FILE__));
define('ODS_PLUGIN_BASENAME', plugin_basename(__FILE__));

/**
 * Autoload
 */
require_once( ODS_PLUGIN_DIR . 'vendor/autoload.php' );
\A7\autoload( ODS_PLUGIN_DIR . 'src' );

```

å¤–æ› Header é ­å¹¾è¡Œçš„è¨»è§£æ˜¯å¿…è¦çš„ï¼Œå…·é«”å…§å®¹å¯ä»¥åƒè€ƒ Handbookï¼Œdefine çš„å¸¸æ•¸å®šç¾©æˆ‘æœƒå…ˆæŠŠå¹¾å€‹å¸¸ç”¨çš„è·¯å¾‘å­˜èµ·ä¾†ï¼Œå› ç‚º plugin_dir_xxx åœ¨ä¸åŒå±¤ç´šçš„æª”æ¡ˆä¸‹æœƒå°æ‡‰åˆ°ä¸åŒçš„è·¯å¾‘ï¼Œç›´æ¥åœ¨ä¸»æª”æ¡ˆå­˜èµ·ä¾†æ‰èƒ½æ­£ç¢ºå°æ‡‰åˆ°å¤–æ›çš„æ ¹ç›®éŒ„ã€‚

å†å¾€ä¸‹çœ‹å°±æ˜¯æœ€é—œéµçš„ Autoloadï¼Œç¬¬ä¸€å€‹ require_once è¼‰å…¥çš„æ˜¯ vendor/autoload.phpï¼Œä¹Ÿå°±æ˜¯é€é Composer å®‰è£çš„å¥—ä»¶åªéœ€è¦é€™ä¸€è¡Œå°±å¯ä»¥å…¨éƒ¨è‡ªå‹•å¼•å…¥ï¼Œä½¿ç”¨æ™‚åªéœ€è¦é€é Namespace çš„ use é—œéµå­—å³å¯ä½¿ç”¨ï¼Œ

è€Œä¸‹ä¸€è¡Œçš„ \\A7\\autoload å‰‡æ˜¯æŒ‡å®šè‡ªå‹•è¼‰å…¥ src ç›®éŒ„åº•ä¸‹æ‰€æœ‰çš„æª”æ¡ˆï¼Œä¸ç®¡æœ‰å¹¾å±¤ç›®éŒ„ã€å¤šå°‘æª”æ¡ˆï¼Œé€éå®ƒå°±å¯ä»¥è‡ªå‹•å®Œæ•´è¼‰å…¥ï¼Œç¸±ä½¿ä¿®æ”¹äº†æª”åæˆ–æ˜¯è³‡æ–™å¤¾åç¨±ï¼Œä¾èˆŠéƒ½èƒ½æ­£å¸¸é‹ä½œã€‚

a7\\autoload æ˜¯ç”± Aaron Holbrook æ‰€é–‹ç™¼çš„ï¼Œè§€å¯Ÿä»–çš„ç¨‹å¼ç¢¼ï¼Œä»–ä½¿ç”¨äº†è¿´åœˆå»æƒææŒ‡å®šç›®éŒ„çš„æ‰€æœ‰æª”æ¡ˆï¼Œç„¶å¾Œå†é€é autoload æ©Ÿåˆ¶å»é€ä¸€è¼‰å…¥ï¼Œé›–ç„¶è©²å¥—ä»¶å·²ç¶“æœ‰å…©å¹´å¤šæ²’æ›´æ–°äº†ï¼Œä½†ç”¨åˆ°ç›®å‰ç‚ºæ­¢éƒ½éå¸¸çš„ç©©å®šæ²’å‡ºéä»»ä½•å•é¡Œï¼Œå› æ­¤å®ƒæˆç‚ºæˆ‘æ¯å€‹å°ˆæ¡ˆçš„å¿…å‚™å¥—ä»¶ã€‚

åˆ°é€™é‚Šè‡ªå‹•è¼‰å…¥å°±å®Œæˆäº†ï¼Œæ—¥å¾Œå¦‚æœæˆ‘æ–°å¢æˆ–ä¿®æ”¹ä»»ä½• src è³‡æ–™å¤¾è£¡é¢çš„ä»»ä½•æª”æ¡ˆåç¨±ï¼Œå°±å†ä¹Ÿä¸ç”¨é‡æ–°èª¿æ•´è¼‰å…¥çš„è·¯å¾‘äº†ï¼Œä¸€å‹æ°¸é€¸ ğŸ‰

### 4. Git è¨­å®š

ç‚ºäº†è¦èƒ½åšåˆ°ç‰ˆæœ¬æ§ç®¡èˆ‡è‡ªå‹•éƒ¨ç½²ï¼ŒGit ç‰ˆæ§ä¹Ÿæ˜¯æˆ‘æ¯å€‹å¿…ç”¨çš„å·¥å…·ï¼Œæ—©æœŸçœ‹åˆ°æœ‹å‹çš„ä½œæ³•æ˜¯ç›´æ¥æŠŠæ•´å€‹ wp-content è³‡æ–™å¤¾éƒ½ç´å…¥ç‰ˆæ§ï¼Œå¥½è™•æ˜¯æ‰€æœ‰å¤–æ›çš„æ›´æ–°éƒ½å¯ä»¥å¾ git ä¾†ç®¡ç†ï¼Œæ–¼æ˜¯æˆ‘ä¹Ÿæ¡ç”¨é€™æ¨£çš„ä½œæ³•ï¼Œä½†ç¶“éå¹¾å€‹å°ˆæ¡ˆå¾Œç™¼ç¾æœ‰äº›å•é¡Œï¼š

é¦–å…ˆæ˜¯å¿…é ˆè¦æŠŠå®¢æˆ¶æ•´å€‹ç«™çš„ wp-content éƒ½ clone ä¸‹ä¾†ï¼Œé‡åˆ°æ¯”è¼ƒå¤§å‹çš„ç«™é€™å°æˆ‘ 128GB çš„ MBP è² æ“”å¾ˆå¤§...

å…¶æ¬¡åœ¨è¨­å®š .gitignore æ™‚è¦è™•ç†æ¯”è¼ƒå¤šçš„éƒ¨åˆ†ï¼Œæœ‰æ™‚å€™ä¹Ÿæœƒä¸å°å¿ƒæŠŠéœ€è¦ ignore çš„æ±è¥¿çµ¦ commit é€²å»ã€‚å¦å¤–å¦‚æœè¦æä¾›çµ¦å®¢æˆ¶ä¸‹è¼‰æ­£åœ¨é–‹ç™¼ä¸­çš„å¤–æ›æ™‚ï¼Œç›´æ¥ download å°±æœƒæŠ“å›ä¸€å¤§åŒ…ï¼Œå®¢æˆ¶é‚„è¦å¾ä¸€å¤§åŒ…ä¹‹ä¸­å»æ‰¾åˆ°æ­£ç¢ºçš„å¤–æ›ã€‚

æ‰€ä»¥æˆ‘ç¾åœ¨éƒ½æ˜¯ä¸€æ”¯å¤–æ›åšä¸€å€‹ç‰ˆæ§ï¼Œå¥½è™•æ˜¯æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒåªè¦å®‰è£å¯èƒ½éœ€è¦çš„å¤–æ›å³å¯ï¼Œä¸ç”¨æŠŠæ•´åŒ… wp-content è·Ÿè³‡æ–™åº«è¼‰åˆ°è‡ªå·±çš„é›»è…¦ï¼Œç„¶å¾Œ gitignore ä¹Ÿæ¯”è¼ƒå¥½è¨­å®šï¼Œä¸»è¦æˆ‘æœƒæŠŠæ¸¬è©¦ç›¸é—œä»¥åŠ vendor è³‡æ–™å¤¾å¿½ç•¥æ‰ï¼Œ

æ¸¬è©¦ä¸»è¦æœƒåœ¨æœ¬æ©Ÿä»¥åŠæ¸¬è©¦æ©ŸåŸ·è¡Œï¼Œæ‰€ä»¥ä¸å®œæŠŠæ‰€æœ‰çš„å¥—ä»¶éƒ½ä¸Šå‚³åˆ°æ­£å¼æ©Ÿï¼Œé€™éƒ¨åˆ†éœ€è¦é€éè‡ªå‹•åŒ–éƒ¨ç½²å·¥å…·ä¾†æ±ºå®šå“ªäº›å¥—ä»¶è©²è£å“ªäº›ä¸ç”¨è£ï¼Œé€™éƒ¨åˆ†æœƒåœ¨è‡ªå‹•éƒ¨ç½²ä¸€æ–‡ä¸­æåŠã€‚

å¦å¤–çš„å¥½è™•æ˜¯åœ¨ Github é é¢ä¸Šå¯ä»¥è¨­å®š Releases åŠŸèƒ½ä¾†è®“å®¢æˆ¶ä¸‹è¼‰æŒ‡å®šç‰ˆæœ¬ï¼Œä¹Ÿèƒ½çœ‹åˆ°æ¯å€‹ç‰ˆæœ¬æ›´æ–°çš„é …ç›®ã€‚

ä½†å¦‚æœä¸€å€‹å°ˆæ¡ˆè£¡é¢éœ€è¦é–‹ç™¼å¤šæ”¯å¤–æ›ï¼Œæˆ–æ˜¯æœ‰æ”¹éä¸€äº›æ—¢æœ‰çš„å¤–æ›éœ€è¦ç´å…¥ç‰ˆæ§æ™‚ï¼Œæ•¸é‡ä¸€å¤šå°±æœƒä¸å¥½ç®¡ç†ï¼Œæ–¼æ˜¯æˆ‘æ¡ç”¨ Github çš„ Organization ä¾†é€²è¡Œåˆ†é¡ã€‚æŠŠåŒä¸€å€‹å°ˆæ¡ˆä¸åŒå¤–æ›çš„å­˜æ”¾åº«éƒ½é›†ä¸­ç®¡ç†ã€‚

åœ¨æœ¬æ©Ÿçš„éƒ¨åˆ†å°±ä½¿ç”¨ VSCode çš„å·¥ä½œå€åŠŸèƒ½ï¼ŒæŠŠéœ€è¦è™•ç†åˆ°çš„å¤–æ›éƒ½åŠ é€²åˆ°åŒä¸€å€‹å·¥ä½œå€ï¼Œç„¶å¾Œåœ¨ commit çš„æ™‚å€™é€éå…§å»ºçš„ Git å·¥å…·å„è‡ªè™•ç†ã€‚

### 5.WordPress Coding Standard

åˆ°é€™é‚Šå°±å·²ç¶“å®Œæˆäº†é–‹ç™¼ç’°å¢ƒçš„åŸºæœ¬è¨­å®šï¼Œä½†åœ¨çœŸæ­£é–‹å§‹ coding ä¹‹å‰ï¼Œæœ‰ä»¶äº‹é›–ç„¶ä¸æ˜¯å¼·åˆ¶ä½†æˆ‘é‚„æ˜¯é€¼è‘—è‡ªå·±ç¿’æ…£ï¼Œé‚£å°±æ˜¯ WordPress ç¨‹å¼ç¢¼è¦ç¯„ã€‚

PHP æœ‰ä¸€å¥—è‡ªå·±çš„ç¨‹å¼ç¢¼è¦ç¯„ï¼Œå«åš PHP Standards Recommendations ( PSR )ï¼Œé›–ç„¶ WordPress æ˜¯ç”¨ PHP å¯«çš„ï¼Œä½†åœ¨è¦ç¯„ä¸Šæœ‰è¨±å¤šåœ°æ–¹ä¸ä¸€æ¨£ï¼Œé›–ç„¶è‡ªå·±æœ¬èº«å¾ä¾†æ²’åœ¨ç…§ä»€éº¼è¦ç¯„å¯«ç¨‹å¼ï¼Œä½†è‡ªå¾çŸ¥é“æœ‰é€™æ±è¥¿å¾Œå°±é‚„æ˜¯è¦ºå¾—è¦å˜—è©¦çœ‹çœ‹ï¼Œä¾†å»ºç«‹è‡ªå·±å¯«ç¨‹å¼çš„ç¿’æ…£ã€‚

å› ç‚ºæˆ‘éƒ½æ˜¯åœ¨å¯« WordPressï¼Œæ‰€ä»¥å°±ç†æ‰€ç•¶ç„¶çš„ç…§è‘— WP çš„è¦ç¯„èµ°ï¼Œä¸€é–‹å§‹å¾ˆä¸ç¿’æ…£ï¼Œåˆ°ç¾åœ¨è€å¯¦èªªä¹Ÿé‚„æ˜¯å¾ˆä¸è‡ªåœ¨ï¼Œå¸¸å¸¸å…‰æ˜¯è¦æ•´ç†æ ¼å¼å°±æ‰“æ–·äº†ç¨‹å¼é‚è¼¯çš„æ€è€ƒï¼Œæ‰€ä»¥æ•´ç†è¦ç¯„é€™ä»¶äº‹æˆ‘éƒ½æ˜¯æ”¾åœ¨é‡æ§‹çš„æ™‚å€™ä¾†åšï¼Œç¬¬ä¸€æ¬¡åœ¨å¯«çš„æ™‚å€™å°±ä¸ç®¡å®ƒäº†XD

å¾Œä¾†é€é Terry Lin å¤§å¤§çš„æ¨è–¦çŸ¥é“ VSCode æœ‰å€‹å¥½å·¥å…·å«åš [PHP Sniffer](https://marketplace.visualstudio.com/items?itemName=wongjn.php-sniffer)ï¼Œå¯ä»¥é¸æ“‡è¦éµå¾ªçš„è¦ç¯„ä¸¦ä¸”åœ¨ç·¨è¼¯å™¨ä¸­å³æ™‚é¡¯ç¤ºä¸ç¬¦åˆè¦ç¯„ä¹‹è™•ï¼Œå¦å¤–é‚„å¯ä»¥æ­é…å¿«é€Ÿéµé€²è¡Œä¿®æ­£ï¼Œå¯ä»¥æå®šæˆ‘æœ€è¨å­çš„è®Šæ•¸å°é½Šï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-plugin-boilerplate/wordpress-plugin-boilerplate-03.jpg)

![](https://oberonlai.blog/wp-content/uploads/wordpress-plugin-boilerplate/wordpress-plugin-boilerplate-04.jpg)

è‡ªå‹•ä¿®æ­£å¯ä»¥ä¿®åˆ°ä¸ƒå…«æˆï¼Œå‰©ä¸‹çš„åªè¦è£œä¸Š PHPDoc çš„èªªæ˜å³å¯ã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-plugin-boilerplate/wordpress-plugin-boilerplate-01.jpg)

å®‰è£ PHP Sniffer è¨˜å¾—è¦åœ¨å®ƒçš„è¨­å®šè£¡é¢å°‡ PHPCS Standard æ”¹æˆ WordPressï¼Œé€™æ¨£å°±æœƒä»¥ WordPress çš„ç¨‹å¼ç¢¼è¦ç¯„ä¾†æª¢æŸ¥ï¼Œæ›´å¤šé€™éƒ¨åˆ†çš„èªªæ˜å¯ä»¥åƒè€ƒ[ä½¿ç”¨ PHP CodeSniffer å¹«åŠ©ç†Ÿæ‚‰ WordPress ç¨‹å¼ç¢¼é¢¨æ ¼](https://ithelp.ithome.com.tw/articles/10244668?sc=hot)ã€‚

å®‰è£èˆ‡è¨­å®šå®Œæˆå¾Œï¼Œå°±æœƒçœ‹åˆ°æœ‰ä¸ç¬¦åˆè¦ç¯„çš„åœ°æ–¹æœƒåœ¨ä¸‹é¢å‡ºç¾ç´…è‰²æ³¢æµªç·šï¼Œæ»‘é¼ åœç•™åœ¨ä¸Šé¢ä¸€ä¸‹ä¸‹å°±æœƒå‡ºç¾è¦ç¯„èªªæ˜ï¼Œç„¶å¾Œæ ¹æ“šèªªæ˜é€²è¡Œä¿®æ”¹å³å¯ã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-plugin-boilerplate/wordpress-plugin-boilerplate-02.jpg)

é€™é‚Šè£œå……ä¸€ä¸‹ï¼Œæœ‰æ™‚å€™æœƒé‡åˆ°ç„¡æ³•ç¬¦åˆè¦ç¯„çš„ç‹€æ³ï¼Œåƒæ˜¯è¦ä½¿ç”¨å…¶ä»–å¤–æ›çš„è®Šæ•¸åç¨±ï¼Œè€Œé€™å¤–æ›ä¸¦æ²’æœ‰ä¾ç…§è¦ç¯„ä¾†å¯«ï¼Œå¦å¤–ä¸€ç¨®ç‹€æ³æ˜¯ WordPress è¦ç¯„ä¸­é¡åˆ¥çš„æª”åè¦ç”¨ class-xxx.phpï¼Œæœ‰ template tag çš„è¦ç”¨ xxx-template.php é€™æ¨£ï¼Œ

ä½†åœ¨ç ”ç©¶ PHPUnit å–®å…ƒæ¸¬è©¦çš„æ™‚å€™ç™¼ç¾é€™æ¨£ç„¡æ³•é‹ä½œï¼ŒåŸå› æ˜¯ PHPUnit æ¸¬è©¦æª”è¦è¼‰å…¥è¢«æ¸¬è©¦çš„é¡åˆ¥æ™‚ï¼Œå¿…é ˆè¦ç”¨ PSR-4 çš„æ©Ÿåˆ¶ä¾†è¼‰å…¥ï¼Œç„¶å¾Œ PSR-4 è¦å®šé¡åˆ¥å«ä»€éº¼æª”åå°±è¦å«ä»€éº¼ï¼Œ

å¦‚æœé¡åˆ¥å«åš Userï¼Œå‰‡æª”åå°±ä¸€å®šè¦å«åš User.phpï¼Œå¯« class-User.php æœƒç„¡æ³•è¼‰å…¥ï¼Œæˆ‘æ¸¬è©¦éç”¨ require æˆ– include ä¹Ÿç„¡æ³•æ­£ç¢ºè¼‰å…¥ï¼Œæœ€å¾Œåªèƒ½å¿½ç•¥æŸäº› WordPress ç¨‹å¼ç¢¼è¦ç¯„ã€‚

å¿½ç•¥çš„å¸¸ç”¨æ–¹æ³•æœ‰å…©ç¨®ï¼Œåˆ†ç‚ºå¿½ç•¥ç•¶è¡Œæˆ–å¤šè¡Œï¼Œå–®è¡Œçš„è©±ç›´æ¥åœ¨è©²è¡Œå¾Œé¢åŠ å…¥è¨»è§£ï¼Œä¸¦æŠŠè¦å‰‡åç¨±å¯«åœ¨è¨»è§£ä¸­å³å¯

```php
$AbCd = 'bbb'; //phpcs:ignore WordPress.NamingConventions.ValidVariableName.VariableNotSnakeCase
```

WordPress ç¨‹å¼ç¢¼è¦ç¯„è¦å®šè®Šæ•¸åç¨±å¿…é ˆè¦ç”¨åº•ç·šè€Œéé§å³°å¼å¯«æ³•ï¼Œé€™æ™‚å€™ç›´æ¥åœ¨å¾Œé¢æ¥ä¸Š //phpcs:ignore åŠ è¦å‰‡åç¨±ï¼Œè¦å‰‡åç¨±å¯ä»¥åœ¨ PHP Sniffer è·³å‡ºçš„æç¤ºè¦–çª—ä¸­é€²è¡Œè¤‡è£½

![](https://oberonlai.blog/wp-content/uploads/wordpress-plugin-boilerplate/wordpress-plugin-boilerplate-05.jpg)

å¦‚æœä¸€æ¬¡è¦å¿½ç•¥å¤šè¡Œå°±æ›´ç°¡å–®äº†ï¼Œåªè¦ç”¨å…©å€‹è¨»è§£æŠŠè¦å¿½ç•¥çš„éƒ¨åˆ†åŒ…ä½å³å¯ï¼š

```php
// @codingStandardsIgnoreStart
$AbCd = 'bbb';
$ACaaa = 'abcdefg';
// @codingStandardsIgnoreEnd
```

## å°çµ

åœ¨é–‹ç™¼ WordPress å¤–æ›æ™‚æ•´åˆ Composer å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®‰è£ä¸€äº›å¯¦ç”¨çš„å¥—ä»¶ä»¥åŠè‡ªç”±çµ„ç¹”è³‡æ–™å¤¾å…§å®¹ï¼Œé€™æ¨£åœ¨ç¨‹å¼é‡æ§‹ä¸Šèƒ½é”åˆ°æœ€å¤§çš„å½ˆæ€§ï¼Œå¦ä¸€æ–¹é¢ï¼Œé€é Coding Standard é¤Šæˆç¨‹å¼æ’°å¯«çš„ç¿’æ…£å¯ä»¥å¹«æœªä¾†çš„è‡ªå·±æˆ–æ˜¯åœ˜éšŠæˆå“¡ç†è§£ç¨‹å¼ç¢¼ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ç¹¼çºŒæŒ–æ˜ Composer æœ‰ä»€éº¼å¥½ç‰©å¯ä»¥ç”¨å§ï½


# WordPress Composer å¥—ä»¶æ¨è–¦

WP æœ€å¼·å¤§çš„éƒ¨åˆ†å°±æ˜¯æœ‰ç”¨ä¸å®Œçš„å¤–æ›ï¼ŒPHP ç•¶ç„¶ä¹Ÿæœ‰ï¼ä¸Š Packagist æˆ– Github æ‰“ WordPress é—œéµå­—å°±èƒ½æ‰¾åˆ°éå¸¸å¤šé©ç”¨æ–¼ WP é–‹ç™¼çš„å¥—ä»¶ï¼Œä»¥ä¸‹å°±å¹¾å¥—æˆ‘å·²ç¶“æ‹¿ä¾†å¯¦æˆ°çš„å¥—ä»¶åšä»‹ç´¹ï¼š

## posttypes

åšå¤–æ›æœ€å¸¸è¦‹çš„éœ€æ±‚å°±æ˜¯è¦æ–°å¢ custom post typeã€custom taxonomyï¼Œæˆ–æ˜¯ä¿®æ”¹æ—¢æœ‰ post type çš„é¡¯ç¤ºåç¨±ä»¥åŠåŠŸèƒ½ä¿®æ”¹ï¼ŒWP åŸç”Ÿçš„æ–¹æ³•äº‹å¯¦ä¸Šä¸é›£ä½¿ç”¨ï¼Œåªè¦å‘¼å« register_post_type() æ›åœ¨ init å°±èƒ½è™•ç†ï¼Œ

ä½†éš¨è‘—å°ˆæ¡ˆçš„è¤‡é›œåº¦æé«˜ï¼Œé¡ä¼¼çš„ç¨‹å¼ç¢¼å°±éœ€è¦è¢«é‡è¤‡å¾ˆå¤šéï¼Œå†åŠ ä¸Šé‚„éœ€è¦è™•ç†å¾Œå° column çš„é¡¯ç¤ºæ¬„ä½ï¼Œæ–°å¢ä¸€å€‹ post type å°±æœƒè®“ç¨‹å¼ç¢¼è½è½é•·ï¼Œè¬ä¸€æœ‰å…©å€‹æˆ–æ›´å¤šå€‹ï¼Œç®¡ç†èµ·ä¾†å°±æœƒéº»ç…©è¨±å¤šã€‚

çˆ¬äº†ä¸€ä¸‹ Github å¾Œï¼Œç™¼ç¾ç”± Joe Grainger å¯«çš„ PostTypes é€™å€‹å¥—ä»¶ï¼Œå®Œå®Œå…¨å…¨å¯ä»¥è§£æ±ºæˆ‘çš„å•é¡Œï¼Œå› ç‚ºä»–éƒ½å¹«æˆ‘å€‘æŠŠåŠŸèƒ½å°è£å¥½äº†ï¼Œåªè¦ new PostType('CPT') å°±å¯ä»¥æ–°å¢ï¼Œå®Œå…¨ä¸ç”¨å†å¯« Hookï¼Œä¸¦é€éè©²ç‰©ä»¶ä¾†å¯¦ä½œ Post Type çš„å„é …åƒæ•¸è¨­å®šï¼š

å…ˆä¾†ç§’å®‰è£ä¸€ä¸‹ï¼š
```
$ composer require jjgrainger/posttypes
```

æˆ‘çš„ç¿’æ…£æ˜¯æœƒåœ¨ src è³‡æ–™å¤¾åº•ä¸‹é–‹ä¸€å€‹èˆ‡ CPT slug åŒåçš„ php æª”ï¼Œç„¶å¾Œå› ç‚ºæˆ‘å€‘å·²ç¶“æœ‰è‡ªå‹•è¼‰å…¥äº†ï¼Œæ‰€ä»¥è¦ç”¨çš„è©±åªéœ€è¦å¯« use é—œéµå­—å³å¯ï¼Œå‡è¨­æˆ‘å€‘çš„éœ€æ±‚å¦‚ä¸‹ï¼š

1. æ–°å¢ä¸€å€‹ Post Type å«åš book
2. æ–°å¢å…©å€‹ book çš„ Taxonomy å«åš travel è·Ÿ business

### æ–°å¢ Custom Post Type

æ ¹æ“šè³‡æ–™çµæ§‹ï¼Œæˆ‘å€‘æœƒè™•ç†åˆ° wp_posts èˆ‡ wp_termsï¼Œæ‰€ä»¥è³‡æ–™å¤¾å…ˆæ–°å¢ posts èˆ‡ termsï¼Œç„¶å¾Œå»ºç«‹ç›¸å°æ‡‰çš„æª”æ¡ˆï¼Œæª”æ¡ˆçµæ§‹å¦‚ä¸‹ï¼š

```
src
â”œâ”€â”€ posts
â”‚   â””â”€â”€ book
â”‚       â””â”€â”€ Book.php
â””â”€â”€ terms
    â”œâ”€â”€ business
    â”‚   â””â”€â”€ Business.php
    â””â”€â”€ travel
        â””â”€â”€ Travel.php
```

æˆ‘è‡ªå·±å¸¸å¸¸æœƒè¢«è‹±æ–‡çš„å–®è¤‡æ•¸ææ··ï¼Œæ‰€ä»¥å¾Œä¾†å°±æ±ºå®šç¬¬ä¸€å±¤æ¯”ç…§è³‡æ–™è¡¨åç¨±ä¸€å¾‹ä½¿ç”¨è¤‡æ•¸ ( postsã€terms )ï¼Œæ–°å¢çš„å…§å®¹æˆ–æ˜¯åŠŸèƒ½ä¸€å¾‹éƒ½ä½¿ç”¨å–®æ•¸ï¼Œç„¶å¾Œæª”åé¦–å­—å‡å¤§å¯«ã€‚æ¥ä¸‹ä¾†å…ˆé–‹å•Ÿ Book.php ä¾†é€²è¡Œ Custom Post Type çš„è¨»å†Šï¼Œæˆ‘å€‘ä½¿ç”¨ posttypes å¥—ä»¶ä¾†è™•ç†ï¼š

```php
use PostTypes\PostType;
$books = new PostType('book');
$books->register();
```

å…©è¡Œå°±æå®šï¼ ğŸ˜

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-01.jpg)

é è¨­åç¨±æˆ–æ˜¯ç”¨ CPT çš„åå­—åŠ ä¸Š s è¤‡æ•¸ï¼Œå¦‚æœè¦ä¿®æ”¹çš„è©±å¯ä»¥åœ¨å»ºç«‹ PostType å¯¦ä¾‹æ™‚å¸¶å…¥ name åƒæ•¸ä¾†é€²è¡Œä¿®æ”¹ï¼š

```php
use PostTypes\PostType;

$name = array(
	'name'   => 'book',  // è¨»å†Š CPT çš„åç¨±
	'plural' => __( 'MyBook', 'btp' ), // é¡¯ç¤ºåç¨±
	'slug'   => 'mybook', // ç¶²å€ä»£ç¨±
);

$books = new PostType( $name );
$books->register();
```

çµæœå¦‚ä¸‹ï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-02.jpg)


å¦‚æœæƒ³è¦ä½¿ç”¨ register_post_type è£¡é¢çš„åƒæ•¸ï¼Œåªè¦å†å‚³å…¥ç¬¬äºŒå€‹ option åƒæ•¸å³å¯ï¼š

```php

use PostTypes\PostType;

$options = array(
	'has_archive' => true,
	'menu_icon'   => 'dashicons-book',
	'supports'    => array( 'title', 'revisions', 'editor', 'author', 'comments', 'custom-fields' ),
);

$books = new PostType( $name, $options );
$books->register();
```

å¦å¤–å¦‚æœæƒ³è¦ä¿®æ”¹æ¨™ç±¤åƒæ˜¯ Add Newã€Edit ç­‰ç­‰çš„å­—ä¸²ï¼Œåªè¦åœ¨ register å®Œæˆå¾ŒæŒ‡å®šå³å¯ï¼š

```php
$labels = array(
    'all_items'          => __( 'æ‰€æœ‰å¥½æ›¸', 'btp' ),
    'add_new'            => __( 'æ–°å¢å¥½æ›¸', 'btp' ),
    'add_new_item'       => __( 'æ–°å¢å¥½æ›¸', 'btp' ),
    'edit_item'          => __( 'ç·¨è¼¯', 'btp' ),
    'new_item'           => __( 'æ–°é …ç›®', 'btp' ),
    'view_item'          => __( 'æª¢è¦–', 'btp' ),
    'view_items'         => __( 'æª¢è¦–', 'btp' ),
    'search_items'       => __( 'æœå°‹', 'btp' ),
    'not_found'          => __( 'ç„¡çµæœ', 'btp' ),
    'not_found_in_trash' => __( 'ç„¡çµæœ', 'btp' )
);

$books = new PostType( $name, $options );
$books->register();
$books->labels( $labels );
```

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-03.jpg)

Book.php å®Œæ•´ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š

```php
<?php

use PostTypes\PostType;

$name = array(
	'name'   => 'book',
	'plural' => __( 'MyBook', 'btp' ),
	'slug'   => 'mybook',
);

$options = array(
	'has_archive' => true,
	'menu_icon'   => 'dashicons-book',
	'supports'    => array( 'title', 'revisions', 'editor', 'author', 'comments', 'custom-fields' ),
);

$books = new PostType( $name, $options );
$books->register();

$labels = array(
	'all_items'          => __( 'æ‰€æœ‰å¥½æ›¸', 'btp' ),
	'add_new'            => __( 'æ–°å¢å¥½æ›¸', 'btp' ),
	'add_new_item'       => __( 'æ–°å¢', 'btp' ),
	'edit_item'          => __( 'ç·¨è¼¯', 'btp' ),
	'new_item'           => __( 'æ–°é …ç›®', 'btp' ),
	'view_item'          => __( 'æª¢è¦–', 'btp' ),
	'view_items'         => __( 'æª¢è¦–', 'btp' ),
	'search_items'       => __( 'æœå°‹', 'btp' ),
	'not_found'          => __( 'ç„¡çµæœ', 'btp' ),
	'not_found_in_trash' => __( 'ç„¡çµæœ', 'btp' ),
);

$books->labels( $labels );
```

ä¸Šé¢é€™æ®µå°±æ˜¯æˆ‘å¹³å¸¸åœ¨ç”¨çš„ç¨‹å¼ç¢¼ç‰‡æ®µã€‚

å¯èƒ½æœƒæœ‰æœ‹å‹å•é€™è·Ÿç›´æ¥å¯« register_post_type() æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿå°±è¨­è¨ˆå…¸ç¯„ä¾†èªªé€™æ˜¯ç¨‹åºå¼ç¨‹å¼è¨­è¨ˆ ( Procedural Programming ) è·Ÿç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆ ( Object Oriented Programming ) çš„å·®åˆ¥ï¼ŒWordPress ä¸»è¦ä½¿ç”¨çš„é‚è¼¯æ˜¯å‰è€…ï¼Œè€Œä¸€äº› PHP æ¡†æ¶åƒæ˜¯ Laravel å°±æ˜¯ç‰©ä»¶å°å‘çš„æ–¹å¼ä¾†è¨­è¨ˆçš„ã€‚

ç¨‹åºå¼ç¨‹å¼è¨­è¨ˆé¡§åæ€ç¾©å°±æ˜¯æŒ‰ç…§ç¨‹å¼ç¢¼çš„é †åºä¾†åŸ·è¡Œï¼Œç„¶å¾Œé€éåˆ¤æ–·å¼ä¾†æ±ºå®šä¸‹ä¸€æ¢è·¯è©²æ€éº¼èµ°ï¼Œæœ‰é»åƒå°æ™‚å€™ç©çš„çˆ¬æ¢¯å­çš„éŠæˆ²ï¼Œé‡åˆ°æ©«ç·šå°±è¦è½‰å½ï¼Œæ²’æœ‰çš„è©±å°±ç›´ç›´å‰é€²ï¼Œåœ¨ WordPress ä¸­æœ€å¸¸è¦‹çš„ä¾‹å­å°±æ˜¯è¦å–å¾—æ–‡ç« åˆ—è¡¨æ™‚ä½¿ç”¨çš„è¿´åœˆå¯«æ³•ï¼š

```php
if( have_posts() ){
    while( have_posts() ){
        the_post();
        the_content();
    };
}
```

å…ˆæª¢æŸ¥ have_posts() æ˜¯å¦æœ‰å›å‚³æ±è¥¿ï¼Œæœ‰çš„è©±ç”¨ while è¿´åœˆå»æŠŠè£¡é¢çš„æ–‡ç« é¡¯ç¤ºå‡ºä¾†ï¼Œç›´åˆ°æ²’æœ‰ç‚ºæ­¢ï¼Œè¨»å†Š CPT ä¹Ÿæ˜¯æŒ‰ç…§ç¨‹å¼ç¢¼é †åºçš„é‚è¼¯ï¼Œå…ˆæŠŠåƒæ•¸å‚³åˆ° register_post_type é€™å€‹å‡½å¼è£¡é¢ï¼Œå†æŠŠé€™å€‹å‡½å¼å‚³åˆ° init çš„å‹¾é» ( Hook ) ä¸Šï¼š

```php
function wpdocs_codex_custom_init() {
    $args = array(
        'public' => true,
        'label'  => __( 'Books', 'textdomain' ),
    );
    register_post_type( 'book', $args );
}
add_action( 'init', 'wpdocs_codex_custom_init' );
```

è€Œç‰©ä»¶å°å‘æ¯”è¼ƒåƒæ˜¯åœ¨ç©æ¨‚é«˜ï¼Œæ‰€æœ‰çš„ç©æœ¨éƒ½æœ‰è‡ªå·±çš„ç‰¹æ€§ï¼Œé€éçµ„åˆé€™äº›ç©æœ¨ä¾†åšæˆæˆå“ï¼ŒåŒæ™‚æ‹†æ‰å¾Œåˆèƒ½å†ç”¨ä¸€æ¨£çš„ç©æœ¨çµ„æˆä¸åŒçš„æ±è¥¿ï¼Œé€™å°±æ˜¯ç‰©ä»¶çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯åƒä¸Šé¢çš„ä¾‹å­ä¸€æ¨£ï¼Œæˆ‘ä½¿ç”¨äº† PostTypes\\PostType é€™å¡Šç©æœ¨ä¾†å®Œæˆè¨»å†Š CPT çš„é€™å€‹æˆå“ï¼š

```php
use PostTypes\PostType;
$books = new PostType('42115');
$books->register();
```

è€Œ Packagist å°±æ˜¯å…¨ä¸–ç•Œæœ€å¤§çš„ç©æœ¨æ± ï¼Œæˆ‘å¯ä»¥åœ¨è£¡é¢æ’¿åˆ°å„å¼å„æ¨£æˆ‘éœ€è¦çš„ç£šï¼Œç„¶å¾Œæ‹¼æˆæˆ‘æƒ³è¦çš„ä½œå“ï¼Œæœ‰åˆ¥æ–¼ç¨‹åºå¼ç¨‹å¼è¨­è¨ˆï¼Œé€éç‰©ä»¶çš„ä»‹é¢æ›´æ–¹ä¾¿é‡è¤‡åˆ©ç”¨ï¼Œä¹Ÿèƒ½æ¸›å°‘æ‰¾ç›¸å°æ‡‰å‹¾é»çš„æ™‚é–“ã€‚

æ‰€ä»¥æˆ‘ç¾åœ¨åˆ»æ„ä½¿ç”¨é€™äº›å¥—ä»¶ä¾†å–ä»£ WP å…§å»ºçš„å‡½å¼ï¼Œè¦ºå¾—é€™æ¨£æ¯”è¼ƒå¥½ç†è§£ä¸¦ä¸”ç›¸å°ç°¡æ½”ï¼Œä½†å¦‚æœå¤–æ›åŠŸèƒ½ç›¸å°å–®ç´”æˆ–æ˜¯ä¸»æ©Ÿç’°å¢ƒå› ç´ ç„¡æ³•ä½¿ç”¨ Composerï¼Œregister_post_type() é‚„æ˜¯ç„¡æ•µå¥½ç”¨çš„XD

### æ–°å¢ Taxonomy

æ¥ä¸‹ä¾†è™•ç†æ›¸çš„åˆ†é¡ä¹Ÿå°±æ˜¯æ—…éŠèˆ‡å•†æ¥­é€™å…©å€‹é¡åˆ¥ï¼Œé–‹å•Ÿ Business.php è¼¸å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š

```php
use PostTypes\Taxonomy;

$business = new Taxonomy( 'business' );
$business->posttype( 'book' );
$business->register();
```

ä¸€æ¨£ï¼Œåˆæ˜¯ä¿è½çš„ä¸‰è¡Œå°±è§£æ±ºï¼Œåªè¦å®£å¿ Taxonomy å¯¦ä¾‹å¾Œå†ç”¨ posttype æ–¹æ³•å»æŒ‡å®š Custom Post Type å°±èƒ½å®Œæˆã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-04.jpg)

ç„¶å¾Œæœ€ç¾å¥½ä¹‹è™•åœ¨æ–¼è¨­å®š Taxonomy çš„æ–¹å¼è·Ÿ Custom Post Type ä¸€æ¨¡ä¸€æ¨£ï¼Œé€™æ”¯é¡åˆ¥çš„ä»‹é¢è¨­è¨ˆå¾—çœŸçš„å¾ˆå¥½ï¼Œéå¸¸æ–¹ä¾¿ä½¿ç”¨ï¼Œçœ‹ä¸‹é¢æ–°å¢ Taxonomy çš„ç¨‹å¼ç¢¼å³å¯æ˜ç™½ï¼š

```php
use PostTypes\Taxonomy;

$name = array(
	'name'   => 'business',
	'plural' => __( 'MyBusinessBook', 'btp' ),
);

$options = array(
	'hierarchical' => false,
);

$business = new Taxonomy( $name, $options );
$business->posttype( 'book' );
$business->register();

$labels = array(
	'all_items'          => __( 'æ‰€æœ‰', 'btp' ),
	'add_new'            => __( 'æ–°å¢', 'btp' ),
	'add_new_item'       => __( 'æ–°å¢', 'btp' ),
	'edit_item'          => __( 'ç·¨è¼¯', 'btp' ),
	'new_item'           => __( 'æ–°é …ç›®', 'btp' ),
	'view_item'          => __( 'æª¢è¦–', 'btp' ),
	'view_items'         => __( 'æª¢è¦–', 'btp' ),
	'search_items'       => __( 'æœå°‹', 'btp' ),
	'not_found'          => __( 'ç„¡çµæœ', 'btp' ),
	'not_found_in_trash' => __( 'ç„¡çµæœ', 'btp' ),
);

$business->labels( $labels );
```

å¯«æ³•åŒ PostTypeï¼Œå°±åªæ˜¯æ›æˆ Taxonomy ä»¥åŠä¿®æ”¹æˆå°æ‡‰çš„è®Šæ•¸åç¨±å³å¯ï¼Œæ‰€ä»¥å¦å¤–ä¸€å€‹åˆ†é¡ Travel æ¯”ç…§è¾¦ç†å³å¯ã€‚

é€™å€‹å¥—ä»¶é‚„æœ‰å¦å¤–ä¸€å€‹å¼·å¤§ä¹‹è™•ï¼Œå®ƒå¯ä»¥æ§åˆ¶å¾Œå°æ–‡ç« åˆ—è¡¨æ¬„ä½çš„æ–°å¢èˆ‡éš±è—ï¼Œé€™éƒ¨åˆ†æœƒè·Ÿå¦å¤–ä¸€å€‹å°ˆé–€åšæ¬„ä½çš„å¥—ä»¶ä¸€èµ·èªªæ˜ã€‚


## wp-metabox

å¯¦å‹™ä¸Šå¸¸é‡åˆ°è¦æ–°å¢æ–‡ç« çš„è‡ªè¨‚æ¬„ä½ä¾†å¢åŠ æ–‡ç« è³‡è¨Šï¼Œæˆ‘æœ€æ„›ç”¨çš„å¤–æ›çµ•å°æ˜¯ ACF Proï¼Œå…¶ä»–é‚„æœ‰åƒæ˜¯ Cmb2ã€Metabox.ioã€Podsã€Toolset ç­‰ç­‰ï¼Œç”¨å¤–æ›ä¾†è™•ç†è‡ªè¨‚æ¬„ä½å°æˆ‘ä¾†èªªæ˜¯å†å¹³å¸¸ä¹Ÿä¸éçš„äº‹ï¼Œç›´åˆ°éœ€è¦æŠŠå¤–æ›ç™¼ä½ˆçµ¦åˆ¥äººç”¨æ™‚ï¼Œæ‰é©šè¦ºåŠ å£“ç¸®ä¹‹å¾Œç«Ÿç„¶æœ‰å¥½å¹¾ MBï¼Œè¿½æŸ¥ä¹‹ä¸‹ ACF Pro å°±æœ‰ 7.7MB ä¹‹å¤šã€‚

æ–¼æ˜¯é‡æ–°æª¢è¦–è‡ªå·±å°æ–¼ ACF çš„ä½¿ç”¨ç¿’æ…£ï¼Œè§€å¯Ÿå¸¸ç”¨çš„åŠŸèƒ½èˆ‡æ¬„ä½æœ‰å“ªäº›ï¼Œäº‹å¯¦ä¸Šä¸å¤–ä¹å°±æ˜¯æœ€åŸºæœ¬çš„æ–‡å­—ã€åœ–ç‰‡ä¸Šå‚³ã€ä¸‹æ‹‰é¸å–®ä»¥åŠé‡è¤‡å™¨æœ€å¸¸ä½¿ç”¨ï¼Œå…¶ä»–æœƒç”¨åˆ°çš„æ©Ÿæœƒå¾ˆå°‘ã€‚

ç‚ºäº†æ‰¾å°‹æ›¿ä»£æ–¹æ¡ˆç…§æ…£ä¾‹å…ˆå» Packagist çˆ¬äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°ä¸å°‘å¥—ä»¶åœ¨åšï¼Œä½†åŸºæœ¬ä¸Šéƒ½è·Ÿ ACF å·®ä¸å¤šï¼ŒåŠŸèƒ½åŒ…å±±åŒ…æµ·é«”ç©ä¹Ÿæ˜¯éå¸¸å¯è§€ï¼Œæœ€å¾Œå›åˆ° Github æ‰¾åˆ°ç”± Matthew Kosloski æ‰€å¯«çš„ [wp-metabox-constructor-class](https://github.com/MatthewKosloski/wp-metabox-constructor-class)ï¼Œå‰›å¥½è£¡é¢æä¾›çš„æ¬„ä½å¯ä»¥æ»¿è¶³æˆ‘çš„åŸºæœ¬éœ€æ±‚ã€‚

ä½†è©²é¡åˆ¥ä¸Šæ¬¡æ›´æ–°æ˜¯å››å¹´å‰äº†ï¼Œä¹Ÿæ²’æœ‰ä¸Šæ¶ Packagistï¼Œæ‰€ä»¥æˆ‘å°±æŠŠå®ƒæ•´ç†äº†ä¸€ä¸‹å¾Œä¸Šå‚³ï¼Œæ•´ç†çš„éç¨‹ä¸­ç™¼ç¾åˆ°è¦æ–°å¢æ¬„ä½é¡å‹é€²å»ä¹Ÿä¸é›£ï¼Œæ‰€ä»¥æˆ‘ç¾åœ¨éƒ½æ‹¿é€™å¥—ç•¶æˆ‘çš„ Metabox ä¸»åŠ›é–‹ç™¼å¥—ä»¶ã€‚

ä¸»è¦æä¾›å…­ç¨®æ¬„ä½ï¼šTextã€Textareaã€Checkboxã€Image Uploadã€Editorã€Repeaterï¼Œå®‰è£æ–¹å¼å¦‚ä¸‹ï¼š

```bash
$ composer require oberonlai/wp-metabox
```

å‡è¨­æˆ‘å€‘ç¾åœ¨è¦å¹«æ›¸å¢åŠ ä¸€å€‹ ISBN èˆ‡æ›¸ä»‹æ¬„ä½ï¼Œåˆ†åˆ¥æœƒç”¨æ–‡å­—èˆ‡è¦–è¦ºåŒ–ç·¨è¼¯å™¨ä¾†åšï¼Œæ‰“é–‹ Field.php è¼¸å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š

```php
use ODS\Metabox;

$metabox = new Metabox(
	array(
		'id'       => 'book_info',
		'title'    => 'æ›¸ç±è³‡æ–™',
		'screen'   => 'book',
		'context'  => 'normal',
		'priority' => 'default',
	)
);

$metabox->addText(
	array(
		'id'    => 'book_isbn',
		'label' => 'ISBN',
		'desc'  => 'æ›¸ç±çš„ ISBN',
	)
);

$metabox->addEditor(
	array(
		'id'    => 'book_intro',
		'label' => 'æ›¸ç±ä»‹ç´¹',
		'desc'  => 'æ›¸ç±çš„ç°¡çŸ­ä»‹ç´¹',
	)
);
```

å…ˆä½¿ç”¨ use ä¾†è¼‰å…¥ ODS çš„å‘½åç©ºé–“ Metabox é¡åˆ¥ï¼Œç„¶å¾Œå»ºç«‹ä¸€å€‹ Metabox çš„ç‰©ä»¶ï¼Œé€™æ˜¯æŒ‡ metabox çš„å®¹å™¨ï¼Œæœ‰é€™å®¹å™¨ä¹‹å¾Œæ‰èƒ½æŠŠæ¬„ä½æ”¾é€²å»ï¼Œæ¥ä¸‹ä¾†ä½¿ç”¨ addText è·Ÿ addEditor é€™å…©å€‹æ–¹æ³•ï¼Œå®Œæˆå¾Œå¦‚ä¸‹åœ–ï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-05.jpg)

æ›´å¤šçš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åƒè€ƒ README.mdï¼Œé€™é‚Šæ¨è–¦ä¸€å€‹ VSCode å¥—ä»¶ï¼š[Markdown Preview Enhanced](https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced)ï¼Œå®ƒå¯ä»¥ç›´æ¥åœ¨ VSCode è£¡é¢é è¦½ Markdown æ–‡ä»¶ï¼Œå°±ä¸ç”¨å†è¿”å› Github é é¢æˆ–æ˜¯å¥—ä»¶çš„ç·šä¸Šæ–‡ä»¶å»æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•ã€‚

æ¥ä¸‹ä¾†æˆ‘å€‘æ¥åˆ°å®¢æˆ¶éœ€æ±‚ï¼Œå®¢æˆ¶å¸Œæœ›å¯ä»¥åœ¨æ–‡ç« åˆ—è¡¨é é¢å°±èƒ½çœ‹åˆ° ISBN ä»¥ä¾¿æŸ¥è©¢ï¼Œé€™æ™‚å€™ä¸Šé¢ç”¨éçš„ posttype å¥—ä»¶åˆèƒ½æ´¾ä¸Šç”¨å ´äº†ã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-06.jpg)

æˆ‘å€‘å…ˆåœ¨ posts/book åº•ä¸‹æ–°å¢ä¸€å€‹æª”æ¡ˆå«åš Column.phpï¼Œè¼¸å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š

```php
use PostTypes\Columns;

$books->columns()->add(
	array(
		'isbn' => __( 'ISBN' ),
	)
);
$books->register();
```

ä½¿ç”¨ columns çš„ add æ–¹æ³•ä¾†æ–°å¢æ¬„ä½ï¼Œè£¡é¢å‚³å…¥çš„ä¸€å€‹æ˜¯ä¸€å€‹é™£åˆ—ï¼Œç”¨ key value çš„æ–¹å¼ä¾†å»ºç«‹æ¬„ä½ ID èˆ‡é¡¯ç¤ºåç¨±ï¼Œæœ€é‡è¦çš„æ˜¯æœ€å¾Œä¸€è¡Œçš„ $books->register() ä¸èƒ½æ¼æ‰ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥é‡å°é€™å€‹ ID ä¾†è®€å–è³‡æ–™ï¼š

```php
use PostTypes\Columns;

$books->columns()->add(
	array(
		'isbn' => __( 'ISBN' ),
	)
);
$books->columns()->populate(
	'isbn',
	function ( $column, $post_id ) {
		echo esc_html( get_post_meta( $post_id, 'book_isbn', true ) );
	}
);
$books->register();
```

ä½¿ç”¨çš„æ–¹æ³•æ˜¯ populateï¼Œç¬¬ä¸€å€‹åƒæ•¸å‚³æ¬„ä½ IDï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯å›å‘¼å‡½å¼ï¼Œæˆ‘å€‘ç”¨ get_post_meta ä¾†å–å¾— metabox ä¸­çš„å€¼ï¼Œå®Œæˆå°±èƒ½çœ‹åˆ°æ–°å¢äº†ä¸€å€‹ ISBN æ¬„ä½ï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-07.jpg)

ä½†å®¢æˆ¶å¸Œæœ›æ˜¯æ”¾åœ¨åˆ†é¡ MyBussiness æ¬„ä½çš„å¾Œé¢ï¼Œposttype å¥—ä»¶ä¹Ÿéå¸¸è²¼å¿ƒäº†æä¾›ä¿®æ”¹æ¬„ä½é †åºçš„åŠŸèƒ½ï¼Œå¾å·¦æ•¸éä¾†åˆ†é¡æ¬„ä½æ˜¯ç¬¬ä¸‰å€‹ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦å°‡ ISBN è¨­æˆ 4 å³å¯ï¼š

```php
use PostTypes\Columns;

$books->columns()->add(
	array(
		'isbn' => __( 'ISBN' ),
	)
);
$books->columns()->populate(
	'isbn',
	function ( $column, $post_id ) {
		echo esc_html( get_post_meta( $post_id, 'book_isbn', true ) );
	}
);
$books->columns()->order(
	array(
		'isbn' => 4,
	)
);

$books->register();
```

ä½¿ç”¨ order æ–¹æ³•å°±èƒ½æŒ‡å®šé †åºï¼Œå¦‚æœè¦ç”¨ WordPress åŸæœ¬çš„æ–¹æ³•å¯«å¾ˆéº»ç…©ï¼Œé¦–å…ˆè¦å»ºç«‹ä¸€å€‹ç©ºé™£åˆ—ï¼Œç„¶å¾ŒæŠŠæ—¢æœ‰çš„æ¬„ä½æ”¾é€²å»ï¼Œé€éè¿´åœˆåˆ¤æ–·æ¬„ä½åç¨±æ˜¯å¦ç‚º isbnï¼Œå†åˆ¤æ–·è¿´åœˆå·²ç¶“è·‘åˆ°ç¬¬å¹¾å€‹ï¼Œæœ€é‡è¦çš„æ˜¯æˆ‘æ°¸é è¨˜ä¸èµ·ä¾†å‹¾é» ( Hook ) è¦ç”¨å“ªä¸€å€‹...Orz

æœ€å¾Œå®¢æˆ¶å¸Œæœ›å¯ä»¥æŒ‰ç…§ ISBN é€²è¡Œæ’åºï¼Œé€™ç”¨å‹¾é»ä¾†åšçš„è©±ä¸€æ¨£æ˜¯æœ‰å¾ˆå¤šæ­¥é©Ÿéœ€è¦è™•ç†ï¼Œä½† posttype å¹«æˆ‘å€‘éƒ½æå®šäº†ï¼Œåªè¦ä½¿ç”¨ sortable æ–¹æ³•å³å¯ï¼š

```php
<?php

use PostTypes\Columns;

$books->columns()->add(
	array(
		'isbn' => __( 'ISBN' ),
	)
);
$books->columns()->populate(
	'isbn',
	function ( $column, $post_id ) {
		echo esc_html( get_post_meta( $post_id, 'book_isbn', true ) );
	}
);
$books->columns()->order(
	array(
		'isbn' => 4,
	)
);

$books->columns()->sortable(
	array(
		'isbn' => array( 'isbn', true ),
	)
);

$books->register();
```

ä½¿ç”¨ sortable æ–¹æ³•æŒ‡å®šè¦é€²è¡Œæ’åºçš„æ¬„ä½ IDï¼Œç„¶å¾Œçµ¦å®ƒä¸€å€‹ trueï¼ŒåŒæ¨£çš„é“ç†ï¼Œå¦‚æœå®¢æˆ¶ä»Šå¤©æƒ³è¦è®“æŸå€‹æ¬„ä½åœæ­¢æ’åºï¼Œå‚³å…¥ false å³å¯ã€‚

ä»¥ä¸Šç¨‹å¼ç¤ºç¯„äº†æ–°å¢æ¬„ä½ã€ç”¢ç”Ÿæ¬„ä½è³‡æ–™ã€è‡ªè¨‚é †åºä»¥åŠæ’åºåŠŸèƒ½ï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-08.jpg)

posttype åŠ ä¸Š wp-metabox çœŸçš„å¯ä»¥çœä¸‹å¾ˆå¤šæ™‚é–“å•Šï½

## wp-option

å¦‚æœéœ€è¦é–‹ç™¼çµ¦ç¤¾ç¾¤ä½¿ç”¨çš„å¤–æ›ï¼Œæœ€ä¸å¯æˆ–ç¼ºçš„åŠŸèƒ½å°±æ˜¯è¨­å®šé é¢äº†ï¼Œæœ‰äº†è¨­å®šé é¢å°±èƒ½æŠŠå¤–æ›çš„è¨­å®šå€¼äº¤çµ¦ä½¿ç”¨è€…æ±ºå®šï¼Œé€²è€Œä¾ç…§ä½¿ç”¨è€…éœ€æ±‚å½ˆæ€§èª¿æ•´ã€‚

wp-option é€™å¥—æ˜¯æ ¹æ“š boospot é–‹ç™¼çš„ [boo-settings-helper](https://github.com/boospot/boo-settings-helper) åŠ ä»¥æ”¹è‰¯ï¼Œæˆ‘å¢åŠ äº†ä¸€å±¤å°è£ä»‹é¢ï¼Œç›®çš„æ˜¯æƒ³è¦å¯ä»¥è·Ÿ wp-metabox ä¸€æ¨£å¯ä»¥é€é addText()ã€addSelect() é€™æ¨£çš„èªå¥ä¾†ä½¿ç”¨å®ƒï¼ŒèŠ±äº†å…©å¤©çš„æ™‚é–“è¨­è¨ˆèˆ‡æ•´ç†æ–‡ä»¶ï¼Œç”¨èµ·ä¾†å¯¦åœ¨æ˜¯å¤ªæ„‰æ‚…äº†ï¼Œå†ä¹Ÿä¸ç”¨è¨˜å‹¾é»äº†ã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-10.jpg)

è¦ä½¿ç”¨çš„è©±ç¬¬ä¸€æ­¥å…ˆé€²è¡Œå®‰è£ï¼š

```
composer require oberonlai/wp-option
```

æ¥ä¸‹ä¾†åœ¨å»ºç«‹å¯¦ä¾‹çš„æ™‚å€™ï¼Œå…ˆå‘½åè‡ªå·±çš„å‰ç¶´ä»¥ä½œç‚ºæ¬„ä½åç¨±çš„è¾¨è­˜ï¼Œå°±ä¸æœƒè·Ÿæ—¢æœ‰çš„è¡çªï¼š

```php
require __DIR__ . '/vendor/autoload.php';

use ODS\Option;

$prefix = 'plugin-prefix';

$books = new Option( $prefix );

```

æ•´å€‹å¥—ä»¶çš„ä½¿ç”¨é‚è¼¯å¾ˆå–®ç´”ï¼Œè¦æ–°å¢ä¸€å€‹è¨­å®šé é¢éƒ½æ˜¯ä¸€æ¨£çš„æ­¥é©Ÿï¼š
1. æ–°å¢é¸å–®
2. æ–°å¢åˆ†é 
3. åŠ å…¥æ¬„ä½
4. è¨»å†Šæ¬„ä½

```php
// Require the Composer autoloader.
require __DIR__ . '/vendor/autoload.php';

// Import PostTypes.
use ODS\Option;

$config = new Option( 'plugin-prefix-' );
$config->addMenu();
$config->addTab();
$config->addText();
$config->register(); // Don't forget this.
```

### 1.æ–°å¢é¸å–®
é¦–å…ˆæˆ‘å€‘å…ˆçœ‹å¢åŠ é¸å–®çš„éƒ¨åˆ†ï¼Œè¦å‚³å…¥çš„åƒæ•¸æ˜¯è¨­å®šé æ¨™é¡Œã€é¸å–®æ–‡å­—ã€ä»£ç¨±ï¼Œæ¯”è¼ƒè¦æ³¨æ„çš„æ˜¯å­é¸å–®çš„è¨­å®šï¼Œå¦‚æœä½ æƒ³æŠŠè¨­å®šé¸å–®æ”¾åœ¨æŸå€‹é¸å–®åº•ä¸‹ï¼Œåªè¦æŠŠ submenu åƒæ•¸è¨­å®šç‚º trueï¼Œå†æŠŠ wp-admin å¾Œé¢çš„ç¶²å€è·¯å¾‘å¸¶å…¥ parent åƒæ•¸å³å¯ï¼š

```php
$config->addMenu(
	array(
		'page_title' => __( 'Plugin Name Settings', 'plugin-name' ),
		'menu_title' => __( 'Plugin Name', 'plugin-name' ),
		'capability' => 'manage_options',
		'slug'       => 'plugin-name',
		'icon'       => 'dashicons-performance',
		'position'   => 10,
		'submenu'    => true,
		'parent'     => 'edit.php?post_type=event',
	)
);
```


### 2.æ–°å¢åˆ†é 
æ¥ä¸‹ä¾†æ–°å¢åˆ†é çš„éƒ¨åˆ†ï¼Œæ¯å€‹è¨­å®šé ä¸€å®šéƒ½è¦æœ‰ä¸€å€‹åˆ†é ï¼Œå®ƒå°±æ˜¯åƒæ˜¯æ¬„ä½çš„å®¹å™¨ï¼Œæ‰€æœ‰çš„æ¬„ä½éƒ½è¦æ”¾åœ¨åˆ†é è£¡é¢æ‰æœƒæ­£ç¢ºé¡¯ç¤ºï¼Œid åƒæ•¸å°±æ˜¯åˆ†é å®¹å™¨çš„åç¨±ï¼Œè¦æ–°å¢çš„æ¬„ä½éœ€è¦å¸¶å…¥é€™å€‹åç¨±ï¼Œå°±èƒ½æŠŠè©²æ¬„ä½æŒ‡å®šåœ¨è©²åˆ†é ä¸‹é¢ï¼š

```php
$config->addTab(
	array(
		array(
			'id'    => 'general_section',
			'title' => __( 'General Settings', 'plugin-name' ),
			'desc'  => __( 'These are general settings for Plugin Name', 'plugin-name' ),
		)
	)
);
```

å¦‚æœè¦æ–°å¢å…©å€‹ä»¥ä¸Šçš„åˆ†é ï¼Œå°±å‚³å…¥å…©ç­†é™£åˆ—è³‡æ–™å³å¯ï¼š

```php
$config->addTab(
	array(
		array(
			'id'    => 'general_section',
			'title' => __( 'General Settings', 'plugin-name' ),
			'desc'  => __( 'These are general settings for Plugin Name', 'plugin-name' ),
		),
		array(
			'id'    => 'advance_section',
			'title' => __( 'Advanced Settings', 'plugin-name' ),
			'desc'  => __( 'These are advance settings for Plugin Name', 'plugin-name' )
		)
	)
);
```

### 3.æ–°å¢æ¬„ä½
ç›®å‰è©²å¥—ä»¶å¯ä»¥ä½¿ç”¨çš„æ¬„ä½æœ‰åå››ç¨®ï¼š
-   Text
-   URL
-   Number
-   Color
-   Textarea
-   Radio Button
-   Select
-   HTML
-   Checkbox
-   Multi Select
-   Related
-   Password
-   File
-   Media Upload

æ¯ç¨®çš„ç”¨æ³•éƒ½ä¸€æ¨£ï¼Œè­¬å¦‚è¦å¢åŠ  Text æ¬„ä½ï¼Œä½¿ç”¨ addText() æ–¹æ³•ï¼Œç„¶å¾Œæœ‰å…©å€‹åƒæ•¸è¦å‚³å…¥ï¼Œç¬¬ä¸€å€‹æ˜¯åˆ†é  idï¼Œç¬¬äºŒå€‹æ˜¯è¨­å®šå…§å®¹ï¼Œç¬¬ä¸‰å€‹åƒæ•¸æ˜¯é¸å¡«çš„å›å‘¼å‡½å¼ï¼Œä¸»è¦åŠŸèƒ½åœ¨è‡ªè¨‚ input çš„ DOM çµæ§‹ï¼š

```
$config->addText(
	'general_section',
	array(
		'id'                => 'text_field_id',
		'label'             => __( 'Hello World', 'plugin-name' ),
		'desc'              => __( 'Some description of my field', 'plugin-name' ),
		'placeholder'       => 'This is Placeholder',
		'show_in_rest'      => true,
		'class'             => 'my_custom_css_class',
		'size'              => 'regular',
	),
);
```

å¸¶å…¥ç¬¬ä¸‰å€‹å›å‘¼å‡½å¼çš„ç”¨æ³•ï¼š
```php
$config->addText(
	'general_section',
	array(
		'id'    => 'text_field_id',
		'label' => __( 'Hello World', 'plugin-name' ),
	),
	function( $args ) {
		$html  = sprintf(
			'<input 
 class="regular-text"
 type="%1$s"
 name="%2$s"
 value="%3$s"
 placeholder="%4$s"
 style="border: 3px solid red;"
 />',
			$args['type'],
			$args['name'],
			$args['value'],
			'Placeholder from callback'
		);
		$html .= '<br/><small>This field is generated with callback parameter</small>';
		echo $html;
		unset( $html );
	}
);
```

å¦‚æœæ˜¯è¦åš Radio æˆ–æ˜¯ä¸‹æ‹‰é¸å–®ç”¨æ³•ä¹Ÿä¸€æ¨£ï¼Œå·®åˆ¥åœ¨æ–¼è¦å¤šè¨­å®š option åƒæ•¸ä¾†æ±ºå®šé¸é …ï¼š

```php
$config->addRadio(
	'general_section',
	array(
		'id'      => 'radio_field_id',
		'label'   => __( 'Radio Button', 'plugin-name' ),
		'desc'    => __( 'A radio button', 'plugin-name' ),
		'options' => array(
			'radio_1' => 'Radio 1',
			'radio_2' => 'Radio 2',
			'radio_3' => 'Radio 3',
		),
		'default' => 'radio_2', // é è¨­å€¼
	),
);
```

æ‰€æœ‰æ¬„ä½çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åƒè€ƒå¥—ä»¶è£¡é¢çš„ README.md èªªæ˜ã€‚

### 4.è¨»å†Šæ¬„ä½
æœ€å¾Œä¸€å€‹æ–¹æ³•ä¸éœ€è¦å‚³å…¥ä»»ä½•åƒæ•¸ä½†å»æ˜¯æ˜¯å¿…é ˆçš„ï¼Œå› ç‚ºå®ƒåŒ…å«äº†æ‰€æœ‰ä»¥ä¸Šè¡Œç‚ºçš„å‹¾é»è¨»å†Šï¼Œæ‰€ä»¥è¬ä¸€ä½ ç™¼ç¾é¸å–®ã€åˆ†é ã€æ¬„ä½éƒ½å¯«å¥½äº†å»æ²’åæ‡‰ï¼Œæª¢æŸ¥çœ‹çœ‹æ˜¯å¦æœ‰æ­£ç¢ºè¨»å†Šæ¬„ä½ï¼š

```php
$config->register();
```

ä»¥ä¸Šæ˜¯è¨­å®šå¤–æ›è¨­å®šé¸é …çš„ç”¨æ³•ï¼Œä½ å¯ä»¥å¢åŠ å¤šå€‹è¨­å®šé¸å–®ï¼Œéƒ½æ˜¯ä¸€æ¨£çš„æ­¥é©Ÿèˆ‡æµç¨‹ï¼Œå¦‚æœè¦å–å¾—è¨­å®šå€¼ï¼Œä½¿ç”¨ WordPress å…§å»ºçš„ get_option() å³å¯ï¼Œè¨˜å¾—ä¸è¦å¿˜è¨˜å‰ç¶´å–”ï½

```php
$my_text_field_value = get_option( 'plugin-prefix-my_text_field' );
```

## wp-asset

è¼‰å…¥ JSã€CSS éœæ…‹è³‡æºæª”å¹¾ä¹æ˜¯æ¯å€‹å¤–æ›éƒ½æœƒç”¨åˆ°çš„åŠŸèƒ½ï¼ŒåŸå§‹çš„å¯«æ³•è¦å¸¶å…¥äº”å€‹åƒæ•¸ï¼Œåƒæ•¸çš„å¸¶å…¥é †åºæˆ‘æ¯æ¬¡éƒ½æœƒæéŒ¯ï¼Œå†åŠ ä¸Š wp_register_script()ã€wp_localize_script()ã€wp_enqueue_script() é€™ä¸‰å€‹å‡½å¼éƒ½æœ‰å„è‡ªçš„åƒæ•¸è¦å¸¶å…¥ï¼Œå¸¸å¸¸è¢«æŠ˜é¨°ä¸€ç•ªå¾Œå°±ç«å¤§ä¹¾è„†ç›´æ¥å¼•å…¥ï¼Œç„¶å¾Œå°±æœƒçœ‹åˆ° PHPCS å™´éŒ¯XD

å¹¸å¥½å¾Œä¾†æœ‰ç™¼ç¾ Josantonius å¯«çš„ [WP_Register](https://github.com/Josantonius/WP_Register) å¥—ä»¶å¹«åŠ©æˆ‘è§£æ±ºäº†é€™å€‹å•é¡Œï¼Œç„¶å¾Œæˆ‘åˆæ ¹æ“šå¯¦å‹™ä¸Šæœƒé‡åˆ°çš„æƒ…å¢ƒå†æ”¹å¯«æˆ wp-asset å¥—ä»¶ï¼Œä¸¦åŠ å…¥äº† Ajax åˆ¤æ–·åŠŸèƒ½ï¼Œå®‰è£æ–¹å¼å¦‚ä¸‹ï¼š

```bash
$composer require oberonlai/wp-asset
```

æ¥ä¸‹ä¾†è¼‰å…¥ä¸€å€‹ JS æª”ï¼š
```php

use ODS\Asset

Asset::addScript(
	array(
		'name'  => 'my_script',
		'url'   => ODS_PLUGIN_URL . 'assets/js/script.js',
	),
);
```

æˆ–æ˜¯è¼‰å…¥ CSSï¼š

```php
Asset::addStyle(
	array(
		'name'    => 'my_style',
		'url'     => ODS_PLUGIN_URL . 'assets/css/style.css',
	)
);
```

åˆ†åˆ¥ä½¿ç”¨ addScript èˆ‡ addStyle å…©å€‹æ–¹æ³•ï¼Œç„¶å¾Œé€é name å‘½åæª”æ¡ˆåç¨±èˆ‡ url æŒ‡å®šæª”æ¡ˆè·¯å¾‘å°±èƒ½å®Œæˆè¼‰å…¥ï¼Œæ¯”åŸå§‹çš„ wp_enqueue_script å¥½è¨˜å¤šäº†ï¼Œå…¶ä»–å¯é¸åƒæ•¸å¦‚ä¸‹ï¼š

key | èªªæ˜ | é¡å‹ | å¿…å¡« | é è¨­
:--------------|:------------|:-----:|:----:|------------------------
name | æª”æ¡ˆå”¯ä¸€åç¨± | å­—ä¸² | æ˜¯	
url	| æª”æ¡ˆè·¯å¾‘ |å­—ä¸² | æ˜¯	
admin | åœ¨å¾Œå°è¼‰å…¥ | å¸ƒæ—å€¼ | å¦ | false
deps | ä¾è³´å¥—ä»¶ | é™£åˆ— | å¦ | 
version | ç‰ˆæœ¬è™Ÿ | å­—ä¸² | å¦ | 
footer | åœ¨é å°¾è¼‰å…¥ ( JS é™å®š ) | å¸ƒæ—å€¼ | å¦ | true
ajax | å•Ÿç”¨ Ajax åŠŸèƒ½ ( JS é™å®š ) | å¸ƒæ—å€¼ | å¦ | false
params | éœ€è¦è¼¸å‡ºçµ¦å‰ç«¯çš„åƒæ•¸  ( JS é™å®š ) | é™£åˆ— | å¦
media | åª’é«”é¡å‹ ( CSS é™å®š ) | å­—ä¸² | å¦ |

éœ€è¦ç‰¹åˆ¥èªªæ˜çš„æ˜¯ Ajax JS æª”æ¡ˆçš„è¼‰å…¥ï¼Œç•¶ ajax è¨­å®šç‚º true æ™‚ï¼Œæœƒè‡ªå‹•å¸¶å…¥å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥ç‚º ajax_url èˆ‡ ajax_nonceï¼Œé€™æ¨£å°±èƒ½ç›´æ¥åœ¨ JS å–å¾—ï¼Œå¦‚æœè¦åŠ å…¥å…¶ä»–åƒæ•¸ä½¿ç”¨ params å³å¯ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š

```php
Asset::addScript(
	array(
		'name'    => 'my_ajax',
		'url'     => YOUR_PLUGIN_URL . 'assets/js/ajax.js',
		'deps'    => array( 'jquery' ),
		'ajax'    => true,
		'params'  => array(
			'data1'  => 'my_data_1',
			'data2'  => 'my_data_2',
		)
	)
)
```

åœ¨å‰å°å°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„è¼¸å‡ºï¼š
```html
<script id="my_ajax-js-extra">
var my_ajax = {"data1":"my_data_1","data2":"my_data_2","ajax_url":"https:\/\/local.test\/wp-admin\/admin-ajax.php?action=my_ajax","ajax_nonce":"fead4137e4"};
</script>
```

æœ€å¾Œåœ¨ JS è£¡é¢å°±å¯ä»¥ç›´æ¥å–å¾—ï¼š

```js
jQuery(function($){
    $(document).ready(function(){ 
        $('#btn').on('click',function(){
			var data = {
				action: "my_ajax",
				nonce: my_ajax.ajax_nonce,
				data1: my_ajax.data1,
				data2: my_ajax.data2
			};
			$.ajax({
				url: my_ajax.ajax_url,
				data: data,
				type: 'POST',
				dataType: "json",
				success: function(data){
					console.log(data);
				},
				error: function(data){
					console.log(data);
				}
			})
        })
    }) 
})
```

é€™æ¨£å°±å¯ä»¥çœå»å¯« wp_register_script()ã€wp_localize_script()ã€wp_enqueue_script() çš„éº»ç…©äº†ï¼Œé€éçµ±ä¸€çš„ä»‹é¢ä¾†å®Œæˆ Ajax çš„æª”æ¡ˆå¼•å…¥ã€‚


## wp_ajax

Ajax åœ¨å¤–æ›é–‹ç™¼è£¡é¢é‡åˆ°çš„æ©Ÿç‡ä¸å®šï¼Œä¹Ÿå°±æ˜¯å› ç‚ºä¸ä¸€å®šæ¯æ¬¡éƒ½æœƒç”¨åˆ°ï¼Œç•¶è¦ç”¨çš„æ™‚å€™å°±æœƒå¿˜è¨˜è©²æœ‰çš„æµç¨‹è·Ÿæ­¥é©Ÿï¼Œ

1. è¨»å†Š JS æª”ä¸¦è¨­å®šè¦å‚³çµ¦å‰ç«¯çš„å¾Œç«¯è®Šæ•¸
2. è¨»å†Š Ajax çš„å›å‘¼å‡½æ•¸ï¼Œåš Nonce é©—è­‰è·Ÿå–å¾—å‰ç«¯å‚³ä¾†çš„åƒæ•¸å¾Œåšäº‹æƒ…
3. æŠŠè™•ç†çµæœå›å‚³çµ¦å‰ç«¯

ä¹‹å‰æˆ‘å¸¸ç”¨çš„æ˜¯ç”± Anthony Budd çš„ [WP_AJAX](https://github.com/anthonybudd/WP_AJAX)ï¼Œä»–å¯«äº†ä¸€å€‹ WP_AJAX æŠ½è±¡é¡åˆ¥ä¾†è®“æˆ‘å€‘ç¹¼æ‰¿ï¼Œè£¡é¢æœ‰å…§å»ºä¸€äº›å¯¦ç”¨çš„æ–¹æ³•ï¼Œåƒæ˜¯ç”¨ get() å–å¾—å¾å‰ç«¯å‚³ä¾†çš„åƒæ•¸ã€æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥ã€å–å¾— HTTP è«‹æ±‚æ–¹å¼ç­‰ç­‰ã€‚

å®‰è£æ–¹å¼ï¼š

```
$ composer require oberonlai/wp-ajax
```

åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š


```php
use ODS\Ajax;

Class MyAjax extends Ajax {

    protected $action = 'my_ajax';

    protected function run(){

    	// è¦åšçš„äº‹æƒ…æ”¾é€™é‚Š
    	
    	update_option('name', $this->get('name'));

    }
}
MyAjax::listen();
```

å…ˆç¹¼æ‰¿ Ajax é€™å€‹é¡åˆ¥ï¼Œç„¶å¾Œè¨­å®š $action é€™å€‹çµ¦ JS ç”¨çš„è­˜åˆ¥åç¨±ä»¥åŠå¯¦ä½œ run æ–¹æ³•ä¹Ÿå°±æ˜¯å¯¦éš›è¦è™•ç†çš„å‹•ä½œï¼Œæœ€å¾Œå†ç”¨éœæ…‹æ–¹æ³• listen å®Œæˆ Ajax è¨»å†Šå³å¯ã€‚

listen æ–¹æ³•å¸¶æœ‰æœ‰ä¸€å€‹å¸ƒæ—å€¼åƒæ•¸ï¼Œå¦‚æœè¨­å®šç‚º MyAjax::listen( false ) çš„è©±å‰‡ä»£è¡¨åªæœ‰å·²ç™»å…¥çš„ä½¿ç”¨è€…æ‰èƒ½åŸ·è¡Œé€™å€‹ Ajaxã€‚

æˆ‘å€‘æ­é…ä¸Šé¢çš„ wp-asset å¥—ä»¶ä¾†å¯¦ä½œä½¿ç”¨ Ajax æ›´æ–°æ–‡ç« æ¨™é¡Œï¼š

```php
use ODS\Asset;
use ODS\Ajax;

Asset::addScript(
	array(
		'name'    => 'my_ajax',
		'url'     => ODS_PLUGIN_URL . 'assets/js/ajax.js',
		'deps'    => array( 'jquery' ),
		'version' => ODS_VERSION,
		'ajax'    => true,
		'params'  => array(
			'data1' => 'my_data_1',
			'data2' => 'my_data_2',
		),
	),
);

class MyAjax extends Ajax {
	protected $action = 'my_ajax';
	protected function run() {
		$nonce = $this->get( 'nonce' );
		if ( ! wp_verify_nonce( $nonce, 'my_ajax' ) ) {
			$this->JSONResponse( __( 'ç™¼ç”ŸéŒ¯èª¤ï¼Œä¸åˆæ³•çš„è«‹æ±‚ä¾†æºï¼', 'my-plugin' ) );
			exit;
		}
		$url     = wp_get_referer();
		$post_id = url_to_postid( $url );
		$my_post = array(
			'ID'         => $post_id,
			'post_title' => 'This is the 123',
		);
		wp_update_post( $my_post );
		$this->JSONResponse( $post_id );
	}
}
MyAjax::listen(false);

```

é¦–å…ˆï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ $this->get() ä¾†å–å¾—å¾ JS å‚³ä¾†çš„åƒæ•¸ï¼Œåœ¨åšä»»ä½• Ajax çš„å·¥ä½œä¹‹å‰ï¼Œä½¿ç”¨ nonce ä¾†åšè«‹æ±‚ä¾†æºé©—è­‰æ˜¯å¿…è¦çš„ï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆå–å¾—å‰ç«¯å‚³ä¾†çš„ nonceï¼Œç„¶å¾Œç”¨ wp_verify_nonce ä¾†åˆ¤æ–·ã€‚

æ¥ä¸‹ä¾†æŠŠè¦åŸ·è¡Œçš„å·¥ä½œæ”¾åœ¨ run() è£¡é¢ï¼Œé€™é‚Šä½¿ç”¨ wp_update_post åšè³‡æ–™æ›´æ–°ï¼Œæœ€å¾Œç”¨å…§å»ºçš„ JSONResponse æ–¹æ³•æŠŠè™•ç†çµæœå›å‚³çµ¦å‰ç«¯ï¼Œæ³¨æ„åˆ°é€™é‚Šä½¿ç”¨ listen( false ) ä¹Ÿå°±æ˜¯ä»£è¡¨åªæœ‰ç™»å…¥çš„ä½¿ç”¨è€…æ‰èƒ½åŸ·è¡Œé€™å€‹ä¿®æ”¹ã€‚

é€éä»¥ä¸Šå¯«æ³•å¯ä»¥çœç•¥è¦çµ„åˆå‹¾é» wp_ajax_my_ajax èˆ‡ wp_ajax_nopriv_my_ajax é€™å…©å€‹å‹•ä½œï¼Œå†æ­é… wp-asset æ›´èƒ½æ–¹ä¾¿è¼‰å…¥ JS æª”ã€‚


## wp-router
åœ¨é–‹ç™¼å¤–æ›çš„æ™‚å€™å¸¸é‡åˆ°éœ€è¦èƒŒæ™¯å‘¼å«çš„ç‹€æ³ï¼Œåƒæ˜¯ä¸²æ¥ API æ™‚è¦æ¥æ”¶ç¬¬ä¸‰æ–¹å›å‚³çš„è³‡æ–™ï¼Œæˆ–æ˜¯ä¸€äº›ä¸éœ€è¦å‰ç«¯ä»‹é¢çš„è³‡æ–™è™•ç†é ï¼Œä»¥å‰æˆ‘æœƒåœ¨å¾Œå°æ–°å¢é é¢ï¼Œç„¶å¾Œç”¨ page-slug.php çš„ç¯„æœ¬ä¾†å¯«é€™äº›åŠŸèƒ½ï¼Œæˆ–æ˜¯è¨»å†Š REST API çš„ Endpoint ä¾†è™•ç†ï¼Œä½†ä¸ç®¡æ˜¯å“ªå€‹æ–¹æ³•ï¼Œéƒ½æœƒæœ‰å¤šå€‹æ­¥é©Ÿéœ€è¦å»ºç«‹ï¼Œç”¨èµ·ä¾†ä¸æ˜¯é‚£éº¼ç›´è¦ºã€‚

å¾Œä¾†æ‰¾åˆ° Tim Field å¯«çš„ [wordpress-dispatcher](https://github.com/tim-field/wordpress-dispatcher) å¥—ä»¶ï¼Œå¯ä»¥éå¸¸ç›´è¦ºçš„ä¾†æ ¹æ“šç¶²å€åŸ·è¡Œå‡½å¼ï¼Œå®‰è£æ–¹å¼å¦‚ä¸‹ï¼š

```shell
$ composer require oberonlai/wp-router
```

ç„¶å¾Œä½¿ç”¨éœæ…‹æ–¹æ³• routesï¼Œå‚³å…¥æŒ‡å®šçš„é™£åˆ—åƒæ•¸ï¼š

```php
use ODS\Router;

Router::routes( 
	array (
		'testing-a-url' => function(){
		    echo 'Hello World';
		},
	)
);
```

é€™æ¨£ç•¶è¼¸å…¥ç¶²å€ https://example.com/testing-a-url å°±èƒ½çœ‹åˆ°è¼¸å‡ºçš„å…§å®¹ï¼Œç¶²å€è¦å‚³å…¥å‹•æ…‹çš„åƒæ•¸ï¼Œä¹Ÿèƒ½ç”¨æ­£è¦è¡¨é”å¼ä¾†é™å®šå¯å¸¶å…¥çš„åƒæ•¸ï¼š

```php
use ODS\Router;

Router::routes( 
	array (
		'hello-([a-z]+)' => function($request, $name){
		    echo "Hello $name";
		}
	)
);
```

ç•¶è¼¸å…¥ç¶²å€ https://example.com/hello-a æˆ–æ˜¯ https://example.com/hello-b ä¸€æ¨£å¯ä»¥è¼¸å‡ºå‡½å¼çš„å…§å®¹ï¼Œé€™å€‹åŒ¿åå‡½å¼å¸¶æœ‰å…©å€‹åƒæ•¸ï¼Œ\$request æ˜¯è«‹æ±‚è·¯å¾‘ï¼Œ\$name æ˜¯æ‹¬å¼§å…§çš„åƒæ•¸ï¼Œæ‰€ä»¥ä¸Šé¢é€™å€‹ä¾‹å­æœƒè¼¸å‡º Hello a ä»¥åŠ Hello bï¼Œé€™æ¨£å°±èƒ½å¾ˆç›´è¦ºçš„æ ¹æ“šè«‹æ±‚è·¯å¾‘ä¾†åŸ·è¡Œå°æ‡‰çš„ç¨‹å¼ã€‚


## å¥—ä»¶çš„ç”¨æ³•æŸ¥çœ‹

é—œæ–¼å¥—ä»¶çš„ç”¨æ³•åŸºæœ¬ä¸Šéƒ½æœƒå¯«åœ¨ README.md çš„æª”æ¡ˆï¼Œä¹Ÿå› ç‚ºéƒ½æ˜¯ Markdown æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†çš„ç·¨è¼¯å™¨éƒ½å¯ä»¥ç›´æ¥é–‹å•Ÿï¼Œé€™æ¨£å°±ä¸ç”¨å†å›åˆ°å¥—ä»¶çš„ github é é¢å»æŸ¥çœ‹ä½¿ç”¨èªªæ˜ï¼Œä½†å¦‚æœç›´æ¥çœ‹ Markdown æ–‡ä»¶é‚„æ˜¯æ¯”è¼ƒä¸ç¿’æ…£ï¼Œä½¿ç”¨ VSCode çš„è©±å¯ä»¥å®‰è£ [Markdown Preview Enhanced](https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced)ã€‚

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-11.jpg)

å®ƒå¯ä»¥åœ¨ VSCode è£¡é¢ç›´æ¥çœ‹åˆ° Markdown æ–‡ä»¶çš„æ ¼å¼é è¦½ï¼Œé‚„å¯ä»¥é¸æ“‡ dark modeï¼Œç¬¦åˆè‡ªå·±çš„é–±è®€ç¿’æ…£ã€‚

### åŒå ´åŠ æ˜ ï¼šå¦‚ä½•ä¸Šå‚³è‡ªå·±çš„å¥—ä»¶ï¼Ÿ

å¦‚æœæ‰¾ä¸åˆ°é©åˆè‡ªå·±çš„å¥—ä»¶è©²æ€éº¼è¾¦ï¼Ÿå¾ˆç°¡å–®ï¼Œå¯«ä¸€å¥—è‡ªå·±çš„æˆ–æ˜¯æ”¹å¯«æ—¢æœ‰çš„å¥—ä»¶ä¾†é”æˆå§ï¼åƒé€™é‚Šæ–‡ç« è£¡é¢æåˆ°çš„æ‰€æœ‰å¥—ä»¶ï¼Œå…¨éƒ½æ˜¯è¸©åœ¨å¤§å¤§çš„è‚©è†€ä¸Šæ•´ç†å‡ºä¾†çš„ï¼Œè€Œæˆ‘ç¿’æ…£ç”¨è‡ªå·±çš„å‘½åç©ºé–“ä¾†æ–¹ä¾¿å®‰è£ï¼Œå› æ­¤è¤‡è£½åˆ°è‡ªå·±çš„å­˜æ”¾åº«ä¹‹å¾Œå†ä¸Šå‚³åˆ° Packagist å³å¯ã€‚

è¦ä¸Šå‚³ Packagist å¥—ä»¶çš„ Composer è¨­å®šæª”åŸºæœ¬å…§å®¹å¦‚ä¸‹ï¼š

```json
{
    "name": "oberonlai/wp-router",
    "description": "Adding router for WordPress.",
    "homepage": "https://github.com/oberonlai/wp-router",
    "license": "MIT",
    "authors": [
        {
            "name": "Oberon Lai",
            "email": "m615926@gmail.com",
            "homepage": "https://oberonlai.blog"
        }
    ],
    "minimum-stability": "stable",
    "require": {
        "php": ">=7.2"
    },
    "autoload": {
        "psr-4": {
            "ODS\\": "src/"
        }
    }
}
```

æœ‰å…©å€‹åœ°æ–¹éœ€è¦æ³¨æ„ï¼šç¬¬ä¸€å€‹æ˜¯ä¸è¦æ”¾å…¥ version ç‰ˆæœ¬è™Ÿçš„åƒæ•¸ï¼Œå› ç‚º Packagist æ˜¯ç”¨ Github çš„ tag ä¾†åˆ¤æ–·ç‰ˆæœ¬ï¼Œå¦‚æœ composer.json è£¡é¢ä¹ŸåŒ…å«çš„æœƒç™¼ç”ŸéŒ¯äº‚ã€‚

ç¬¬äºŒå€‹é—œéµæ˜¯ autoloadï¼Œæˆ‘çš„å‘½åç©ºé–“çµ±ä¸€ä½¿ç”¨ ODS ( Oberon Design System )ï¼Œç„¶å¾Œè‡ªå‹•è¼‰å…¥ src è³‡æ–™å¤¾è£¡é¢çš„æª”æ¡ˆï¼Œæ‰€ä»¥ä¹‹å¾Œè¦ç”¨çš„æ™‚å€™åªè¦å¯« use ODS\\é¡åˆ¥åç¨± å³å¯ã€‚

æˆ‘ç¿’æ…£ç”¨çš„ç‰ˆæœ¬æ§ç®¡å·¥å…·æ˜¯ Githubï¼Œæ‰€ä»¥æº–å‚™å¥½å¥—ä»¶è·Ÿå‘½åç©ºé–“å¾Œå°±å¯ä»¥æ¨ä¸Šå»äº†ï¼Œæ¥ä¸‹ä¾†å‰å¾€ Packagist è¨»å†Šä¸€å€‹å¸³è™Ÿï¼Œè¨»å†Šå®Œæˆå¾Œå°±èƒ½æäº¤è‡ªå·±çš„å¥—ä»¶ï¼š

![](https://oberonlai.blog/wp-content/uploads/wordpress-and-composer/wordpress-and-composer-12.jpg)

ç›´æ¥åœ¨ Repository URL è²¼å…¥ä½ çš„ Github å­˜æ”¾åº«ç¶²å€å³å¯ï¼ŒæŒ‰ä¸‹ Check å¾Œä»–æœƒæé†’ä½ æœ‰å…¶ä»–é¡ä¼¼åç¨±çš„å¥—ä»¶ï¼Œç›´æ¥ Submit å¾Œå°±å®Œæˆäº†ã€‚

å¦‚æœä¹‹å¾Œç™¼ç¾å¥—ä»¶æœ‰åœ°æ–¹éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹å®Œå¾Œä¸€æ¨£ç›´æ¥å…ˆæ¨ä¸Š Githubï¼Œå› ç‚º Packagist æ˜¯ç”¨ tag ä¾†æŠ“ç‰ˆæœ¬è³‡è¨Šï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆæŠŠä¿®æ”¹å¾Œçš„ commit å»ºç«‹ä¸€å€‹æ–°çš„ tagï¼š

```shell
git tag -a 'v1.0.1' -m 'é€™æ¬¡æ”¹çš„æ±è¥¿'
```

å†æŠŠé€™å€‹ tag æ¨ä¸Šå»ï¼š

```php
git push origin v1.0.1
```

é€™æ¨£åœ¨ Packagist å°±èƒ½æ¥æ”¶åˆ°æ›´æ–°ç‰ˆæœ¬çš„è³‡è¨Šäº†ï¼Œç‰ˆæœ¬è™Ÿçš„å‘½åæ…£ä¾‹æ˜¯ v1.0.x æ˜¯é™¤éŒ¯ã€å®‰å…¨æ€§ä¿®æ”¹ã€v1.x.0 æ˜¯æ–°å¢åŠŸèƒ½ã€vX.0.0 æ˜¯åŒ…å«ç›¸å®¹æ€§å•é¡Œçš„å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œé€™æ¨£å°±èƒ½è®“ä½¿ç”¨è€…çŸ¥é“é€™æ¬¡æ›´æ–°çš„è¦æ¨¡å¤§å°ï¼Œä»¥ä¾¿è®“ä»–å€‘è‡ªè¡Œæ±ºå®šæ˜¯å¦è¦æ›´æ–°ã€‚

<br>

## å°çµ
é€éæ—¢æœ‰çš„å¥—ä»¶ä¾†é–‹ç™¼å¤–æ›å¯ä»¥å¤§å¹…æå‡å·¥ä½œæ•ˆç‡ï¼Œä½†å¦‚æœæ˜¯å·²ç¶“ç†Ÿæ‚‰ WordPress API çš„æœ‹å‹ï¼Œå¯èƒ½æœƒéœ€è¦èŠ±ä¸€é»æ™‚é–“ä¾†é©æ‡‰é€™æ¨£çš„é–‹ç™¼æ¨¡å¼ï¼Œå› ç‚ºæˆ‘ä¸€é–‹å§‹ä¹Ÿä¸å¤ªç¿’æ…£ï¼Œç›´åˆ°å¾Œä¾†æ±ºå®šæŠŠå¤–æ›ä»¥ç‰©ä»¶å°å‘çš„æ¨¡å¼ä¾†é–‹ç™¼ï¼Œæ‰é©šè¦ºåˆ°é€™æ¨£çš„ä½œæ³•æ‰èƒ½è®“ç¨‹å¼ç¢¼æ˜“æ–¼ç¶­è­·èˆ‡é‡è¤‡åˆ©ç”¨ï¼Œä»¥åŠçµ„åˆä¸åŒçš„ç‰©ä»¶ä¾†å®Œæˆä»»å‹™ã€‚

è€Œé€™æ¨£çš„å¥½è™•æ˜¯å¯ä»¥è®“ç¨‹å¼æ›´æ˜“æ–¼è¢«æ¸¬è©¦ï¼Œé¿å…æ”¹æ±ç‰†å£è¥¿ç‰†çš„æƒ…æ³ä¸€å†ç™¼ç”Ÿã€‚æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘æŠŠé€™æ¨£çš„è¨­è¨ˆæ¨¡å¼è¡ä¼¸åˆ°å‰ç«¯é–‹ç™¼ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« å°‡ä»‹ç´¹å¦‚ä½•åœ¨å¤–æ›è£¡é¢ä½¿ç”¨ç¯„æœ¬æª”ä¿®æ”¹å‰ç«¯ä»‹é¢ä¸¦æ•´åˆå‰ç«¯é–‹ç™¼æµç¨‹ï¼Œå¦å¤–è·Ÿé¢¨ä¸€ä¸‹æœ€è¿‘å¾ˆç´…çš„ TailwindCSSï¼Œè®“å¾Œç«¯å¯ä»¥ç„¡ç—›æ‰‹åˆ» UI ~




## Hook è©²æ€éº¼æ›
ä»¥æ•´åˆ





åŸºæœ¬é¡åˆ¥çš„ hook ä½œæ³•ï¼Œåƒè€ƒ carl Alex çš„ä½œæ³•ï¼Œ


ç¯„æœ¬çš„è¼‰å…¥æ–¹å¼
page-slug.php
template-name.php
woocommerce/checkout

phpcs WordPress å¿«æ·éµ


æ•´åˆ tailwindcss

## å–®å…ƒæ¸¬è©¦
- phpunit

## è‡ªå‹•åŒ–éƒ¨ç½²
buddy å¦‚æœæ˜¯è¦è¨­å®š oragnization çš„è©±è¨˜å¾— grant ä¾†å…è¨±æˆæ¬Šçµ¦ buddy

å®‰è£ PHPCSï¼Œset å®‰è£ä½ç½®æ˜¯è¦ç›®éŒ„çš„çµ•å°è·¯å¾‘ï¼Œ/buddy/repo-name/wpcsï¼Œç„¶å¾Œæª¢æŸ¥çš„æ™‚å€™æŒ‡å®šè³‡æ–™å¤¾ç‚º src å°±å¥½ï¼Œä¸ç„¶ç”¨ . è¨˜æ†¶é«”æœƒè¢«è€—ç›¡ã€‚
```
rm -rf wpcs
git clone -b master https://github.com/WordPress/WordPress-Coding-Standards.git wpcs
phpcs --config-set installed_paths /buddy/ecpay-invoice-free-tax/wpcs
phpcs --standard=WordPress /buddy/ecpay-invoice-free-tax/src
```

å–®ä¸€ç«™
æœ¬æ©Ÿã€æ¸¬è©¦æ©Ÿã€æ­£å¼æ©Ÿ

ç™¼è¡Œå¤–æ›
æœ¬æ©Ÿã€æ¸¬è©¦æ©Ÿã€ç‰ˆæ§æ©Ÿã€å®¢æˆ¶ç«¯

## æ›´æ–°å¤–æ›

## çµèª

## åƒè€ƒè³‡æ–™
phpcs Terry çš„æ–‡ç« 


